!function(){"use strict";angular.module("app.services",["app.storage"])}(),function(){"use strict";function t(t,e){var s=t.defer(),n=new e.Image;return n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){s.webp=n.width>0&&n.height>0,s.resolve()},s}t.$inject=["$q","$window"],angular.module("app.services").factory("WebP",t)}(),function(){"use strict";function t(t){function e(e){var s=t.defer(),n=[];return angular.forEach(e,function(t){n.push(t.promise)}),t.all(n).then(function(){s.resolve(s)}),angular.extend(s,e),s}function s(t){var e=function(){window.SADurl="{URL}",window.SADversion=1,window.SADhome=window.SADurl+"#/deck",window.SADscript?window.SADloaded&&window.SADimport():(window.SADscript=document.createElement("script"),window.SADscript.src=window.SADurl+"import.js",document.getElementsByTagName("head")[0].appendChild(window.SADscript),window.SADloaded=!0)}.toString();return"("+e.replace(/\n/g," ").replace(/  +/g," ").replace("{URL}",t)+")()"}return{getComboPromise:e,bookmarklet:s}}t.$inject=["$q"],angular.module("app.services").factory("Utils",t)}(),function(){"use strict";function t(t,e,s,n){function r(t,n){n&&(n.ctrlKey||n.altKey)?s.go("card.id",{id:t.s.id}):e.$emit("showCard",t)}function o(e,s){return function(){t(function(){e.selectedIndexCopy!==e.selectedIndex&&(e.selectedIndexCopy=e.selectedIndex,s())},n.tabDelay)}}function a(t,s){e.title=t,e.subTitle=s,e.mainTitle=t+(s?" "+s:"")+" | Scrolls & Decks"}return{getTabDelay:o,setTitle:a,showCard:r}}t.$inject=["$timeout","$rootScope","$state","Config"],angular.module("app.services").factory("UtilsUi",t)}(),function(){"use strict";function t(t,e){function s(t,e,s){return t.lazy.length<e.limit-5&&t.lazy.length?!1:(e.limit+=25,e.limit=e.limit>s.items.length?s.items.length:e.limit,!0)}function n(s,n,r,o){function a(){if(r.si===s.selectedIndex)if(s.lazy.length<r.limit&&n.items[s.lazy.length]){var c,l;for(!s.lazy.length&&o.items&&o.items(s.lazy),s.lazy.length<20?(c=s.lazy.length+1,l=e.cardDelay):(c=s.lazy.length+4,c=c>n.items.length?n.items.length:c,l=e.cardBatchDelay);s.lazy.length<c;)s.lazy.push(n.items[s.lazy.length]);var u=(new Date).getTime(),d=u-i;i=u,d>l&&(l=e.cardMinDelay),t(function(){r.running=!1,r.destroyed||(o.items&&o.items(s.lazy),a())},l),r.running=!0}else r.running=!1}var i=(new Date).getTime();return a}return{setNext:s,getPagingIteration:n}}t.$inject=["$timeout","Config"],angular.module("app.services").factory("UtilsPaging",t)}(),function(){"use strict";function t(){function t(t,e){return"name"===t?_.sortBy(e,function(t){return t&&t.deck}):"author"===t?_.sortBy(e,function(t){return t&&t.author}):"resource"===t?_.sortBy(e,function(t){return t&&t.sort}).reverse():"cards"===t?_.sortBy(e,function(t){return t&&-t.havePercent}):"price"===t?_.sortBy(e,function(t){return t&&t.price}):e}function e(t,e,s){var n=s.search||"",r=n.toLowerCase();return _.filter(t,function(t){return t?t.types.length?e.g&&t.g||e.e&&t.e||e.o&&t.o||e.d&&t.d?r?t.deckLowerCase.indexOf(r)>-1||0===t.authorLowerCase.indexOf(r):!0:!1:!0:!1})}return{sort:t,filter:e}}angular.module("app.services").factory("UtilsDecks",t)}(),function(){"use strict";function t(){function t(t,e){return"name"===t?_.sortBy(e,function(t){return t.s.nameLowerCase}):"cost"===t?_.sortBy(e,function(t){return t.s.cost}):"resource"===t?_.sortBy(e,function(t){return t.s.ri}):"kind"===t?_.sortBy(e,function(t){return t.s.kind}):"type"===t?_.sortBy(e,function(t){return t.s.kind+t.s.types}):"decks"===t?_.sortBy(e,function(t){return-t.s.decksCount}):"cards"===t?_.sortBy(e,function(t){return-t.c}):"price"===t?_.sortBy(e,function(t){return t.s.price}):e}function e(t,e){var s=_.trim(t),n=parseInt(s);("-"===s||"—"===s)&&(n="—");var r=_.last(s);return"+"===r?e>=n:"-"===r?n>=e:"?"===r?!0:n===e}function s(t,e,s,r){var o,a=s.search||"",i=a.toLowerCase(),c=e.selectedItem||"";return c=c.name===a?c:null,_.filter(t,function(t){if(!e[t.s.cost]||!e[t.s.r])return!1;if(2===e.star&&r.look[t.s.id])return!1;if(1===e.star&&!r.look[t.s.id])return!1;if(!c){if(i){var s=/^[^\/]*\/[^\/]*\/[^\/]*$/g;return t.s.p&&s.test(i)?(o=i.split("/"),n.filterPoints(o[0],t.s.ap)&&n.filterPoints(o[1],t.s.ac)&&n.filterPoints(o[2],t.s.hp)):t.s.nameLowerCase.indexOf(i)>-1||t.s.id.toString()===i}return!0}return c.kind?t.s.kind===c.name:c.rarity?t.s.rarityText===c.name:c.type?t.s.typesArr.indexOf(c.name)>-1:c.trait?t.s.traits.indexOf(c.name)>-1:c.card?t.s===c.card.s:c.set?t.s.set===c.set:void 0})}var n={sort:t,filterPoints:e,filter:s};return n}angular.module("app.services").factory("UtilsCards",t)}(),function(){"use strict";angular.module("app.storage",["ngStorage"])}(),function(){"use strict";function t(t,e){function s(e,s){r[e]=s,t[e]=s}function n(e){e?angular.copy(o[e],t[e]):angular.extend(r,o)}var r={reset:n,set:s},o={bookmarks:[],recent:[],decks:[],cards:{},settings:e.settings},a=t.$default(o);return angular.extend(r,a),r}t.$inject=["$localStorage","Config"],angular.module("app.storage").factory("Storage",t)}(),function(){"use strict";function t(){return{card:null}}angular.module("app.services").factory("Status",t)}(),function(){"use strict";function t(t,e,s){function n(){e.reset("settings"),angular.copy(e.settings,o.settings),angular.copy(o.settings,o.settingsCopy)}function r(){t(function(){angular.extend(o.settingsCopy,o.settings),angular.extend(e.settings,o.settings)},s.settingsDelay)}var o={settings:angular.copy(e.settings),settingsCopy:angular.copy(e.settings),updateCopy:r,reset:n};return o}t.$inject=["$timeout","Storage","Config"],angular.module("app.services").factory("Settings",t)}(),function(){"use strict";function t(t){var e={image:!0,highlight:!1,decksHighlight:!0,decksAuthor:!0,decksScrolls:!0,decksChart:!0,animate:!0,mirror:!1},s={image:!0,highlight:!1,bundle:!1,name:!1,type:!1,rarity:!1,decks:!1,description:!1,flavor:!1},n={image:!0,rarity:!0,decks:!0,name:!0,type:!0,description:!0,flavor:!0,link:!0},r=".json";return{settingsDelay:450,tabDelay:650,cardDelay:25,cardBatchDelay:0,cardMinDelay:0,version:"0.5.1287",build:new Date("2015-05-15T10:10:32.813Z"),officialApp:"https://darosh.github.io/scrolls-and-decks/",repository:"https://github.com/darosh/scrolls-and-decks/",contentSource:"https://github.com/darosh/scrolls-and-decks/blob/master/client/data/scrolls"+r,license:"https://github.com/darosh/scrolls-and-decks/blob/master/LICENSE",issues:"https://github.com/darosh/scrolls-and-decks/issues",currentInstance:t.location.origin+t.location.pathname,settings:e,settingsCard:n,settingsCards:s,settingsCardFull:angular.extend(angular.copy(n),{terms:!0,link:!1,bundle:!0})}}t.$inject=["$window"],angular.module("app.services").factory("Config",t)}(),function(){"use strict";angular.module("app.directives",[])}(),function(){"use strict";function t(t,e){function s(s,n,r){var o=e(r.appFocus);s.$watch(o,function(e){e===!0&&t(function(){n[0].focus()})})}return{link:s}}t.$inject=["$timeout","$parse"],angular.module("app.directives").directive("appFocus",t)}(),function(){"use strict";function t(){function t(t,e,s){e.css("background-position",s.appArt)}return{link:t}}angular.module("app.directives").directive("appArt",t)}(),function(){"use strict";function t(t,e,s,n){function r(r,i,c){function l(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(n.innerHeight||s.documentElement.clientHeight)&&e.right<=(n.innerWidth||s.documentElement.clientWidth)}function u(){return r.$parent&&r.$parent.toolbarCtrl&&r.$parent.toolbarCtrl.settingsCopy.animate}function d(){function d(){function t(a){r.$$destroyed||a!==r.appAnimation||n.requestAnimationFrame(function(){if(!r.$$destroyed&&a===r.appAnimation){var c=(new Date).getTime(),d=g&&!!$.animations.attack,f=d?$.animations.attack:$.animations.idle;s||(s=c),d&&!m&&(s=c,m=!0,i.addClass("app-wait"));var h=Math.round((c-s)/(1e3/e));h>=f.length&&m&&(s=c,f=$.animations.idle,m=!1,g=!1,h=0,i.removeClass("app-wait"));var k=u()&&y(),C=l(p),v=k&&C?1e3/30:1e3/3,w=h%f.length;(C||0===h)&&(w===o||!k&&null!==o||(o=w,S(f[w]))),n.setTimeout(function(){t(a)},v)}})}var e=24,s=null;!c.appAnimationNoClick&&$.animations.attack&&i.addClass("app-animation-can-attack");var o=null;t(T)}function y(){var t=s[0].getElementsByTagName("md-backdrop");if(t.length){var e=_.find(t,function(t){return"none"!==n.getComputedStyle(t).display});return!e}return!0}function k(t){3===t.length&&t.splice(1,0,1,0,0,1);var e=$.sprites[t[0]],s=264*f+t[5]/(e[4]/e[2]),n=270*f+h+t[6]/(e[5]/e[3]);w.setTransform(t[1],t[2],t[3],t[4],s,n),w.drawImage(D,e[0],e[1],e[2],e[3],0,0,e[2],e[3])}function C(){return r.$parent&&r.$parent.toolbarCtrl&&r.$parent.toolbarCtrl.settingsCopy.dark}function v(){w.setTransform(1,0,0,1,0,0),w.clearRect(0,0,p.width,p.height);var t=.58*a.width,e=.58*a.height;w.globalAlpha=m?C()?.55:.32:C()?.28:.18,w.drawImage(a,0,0,a.width,a.height,(p.width-t)/2,328*f+h,t,e),w.globalAlpha=1}function S(t){v(),angular.forEach(t,k)}c.appAnimationNoClick||i.removeClass("app-animation-can-attack"),i.removeClass("app-wait");var w=p.getContext("2d");if(w.setTransform(1,0,0,1,0,0),w.clearRect(0,0,p.width,p.height),o.promise.then(function(){v()}),r.appAnimation){g=!1,m=!1;var $,T=r.appAnimation,D=new n.Image;n.setTimeout(function(){$=t("data/bundles/"+T+"/data.json",{},{get:{method:"GET",cache:!0}}).get();var s=e.defer();D.src="data/bundles/"+T+"/sprites.png",D.onload=function(){s.img=D,s.resolve(s)},e.all([$.$promise,o.promise,s.promise]).then(function(){n.setTimeout(d,0)})},0)}}var p=s[0].createElement("canvas"),f=1,h=0;p.width=530*f,p.height=490*f,i.append(p);var g=!1,m=!1;c.appAnimationNoClick||i.bind("click",function(){g=u()}),r.$watch("appAnimation",d)}var o=e.defer(),a=new n.Image;return a.src="images/unitstand-19c3af7a.png",o.img=a,a.onload=function(){o.resolve(o)},{link:r,scope:{appAnimation:"="}}}t.$inject=["$resource","$q","$document","$window"],angular.module("app.directives").directive("appAnimation",t)}(),function(){"use strict";angular.module("app.controllers",["app.services"])}(),function(){"use strict";function t(t){this.selectedIndex=0,this.selectedIndexCopy=0,this.selectedIndexChanged=t.getTabDelay(this,angular.noop)}t.$inject=["UtilsUi"],angular.module("app.controllers").controller("TabsCtrl",t)}(),function(){"use strict";function t(t,e){function s(){angular.extend(t.settings,e.settingsCards),t.updateCopy()}function n(){var s=angular.copy(e.settingsCards);t.updateCopy(),angular.forEach(s,function(t,e){s[e]=!0}),angular.extend(t.settings,s),t.updateCopy()}this.change=t.updateCopy,this.settings=t.settings,this.setAll=n,this.resetAll=s}t.$inject=["Settings","Config"],angular.module("app.controllers").controller("SettingsCtrl",t)}(),function(){"use strict";function t(){this.ct={},this.toolbarCtrl={},this.leftCtrl={},this.cardsCtrl={},this.decksCtrl={},this.barCtrl={},this.filterParams={},this.setFilter={}}angular.module("app.controllers").controller("DummyCtrl",t)}(),function(){"use strict";angular.module("app.panels",["app.core","app.services","app.filters"])}(),function(){"use strict";function t(t,e,s,n,r,o,a,i){function c(){e(function(){s.screenfull.toggle()},i.settingsDelay)}function l(){o.reset()}function u(){a.reset()}function d(){r.reset("decks")}function p(){n.reset()}t.resetDecks=d,t.resetSettings=p,t.resetBookmarks=u,t.resetRecent=l,t.fullScreen=c,t.fullScreenEnabled=s.screenfull.enabled,t.screenfull={isFullscreen:s.screenfull.isFullscreen},angular.element(s.document).on(s.screenfull.raw.fullscreenchange,function(){t.$apply(function(){t.screenfull.isFullscreen=s.screenfull.isFullscreen})})}t.$inject=["$scope","$timeout","$window","Settings","Storage","Recent","Bookmarks","Config"],angular.module("app.panels").controller("RightSettingsCtrl",t)}(),function(){"use strict";function t(t,e,s,n,r,o,a,i,c,l,u,d,p,f){function h(){w.deckId="deck.id"===r.current.name?r.params.id:null,r.current.pinCard||o("right-card").close()}function g(t,e,s){o("right-card").close().then(function(){$(t,e,s),r.go("cards")})}function m(){w.c&&(w.decks=S,w.related=v)}function y(t){o("right-card").close().then(function(){r.go("deck.id",{id:t.id})})}function k(t,e){C(e)}function C(t){e(function(){p.card=t,w.c=t,S=_.values(t.s.decks),w.decks=_.take(S,15),v=ScrollsTypes.RelatedCards(t,i,20),w.related=_.take(v,15),n[0].activeElement&&n[0].activeElement.blur();var r=o("right-card");r.isOpen()?s.setTimeout(function(){n[0].getElementById("right-card-content").scrollTop=0,e(function(){l.add(t.s.id)},333.333)}):s.setTimeout(function(){r.open().then(function(){s.setTimeout(function(){n[0].getElementById("right-card-content").scrollTop=0,e(function(){l.add(t.s.id)},333.333)})})},83.333)}),a.eventTrack(t.s.name,{category:"Card"})}var v,S,w=this,$=d.setFilter(u);this.settingsCopy=angular.copy(f.settingsCard),this.filter=u,this.look=c.look,this.set=c.set,this.showCard=C,this.deckPaging=m,this.openDeck=y,this.setFilter=g,this.filterParams=d.filterParams,t.$on("showCard",k),t.$on("$stateChangeSuccess",h)}t.$inject=["$rootScope","$timeout","$window","$document","$state","$mdSidenav","$analytics","Scrolls","Bookmarks","Recent","FilterCards","FilterUtils","Status","Config"],angular.module("app.panels").controller("RightCardCtrl",t)}(),function(){"use strict";angular.module("app",["app.core","app.services","app.directives","app.controllers","app.data","app.layout","app.panels"])}(),function(){"use strict";function t(t){t.state("help",{url:"/help",views:{body:{templateUrl:"app/pages/help/help.html",controller:"HelpCtrl",resolve:{Scrolls:["Scrolls",function(t){return t.promise}]}},side:{templateUrl:"app/pages/help/help-left.html"},bar:{templateUrl:"app/layout/bar.html"}}}).state("help.section",{url:"/:section"})}t.$inject=["$stateProvider"],angular.module("app").config(t)}(),function(){"use strict";function t(t,e,s,n,r,o,a,i,c){function l(){var t=n.params.section;if(t){var s=e[0].getElementById(t);s&&(e[0].getElementById("page-content").scrollTop=s.offsetTop-16)}}function u(){s(l,250)}function d(){s(l)}o.setTitle("Help"),t.config=i,t.scrolls=r,t.bm=a.bookmarklet(i.currentInstance),c.fab=null,t.$on("$locationChangeSuccess",u),t.$on("$viewContentLoaded",d),s(function(){var t=e[0].getElementById("page-content");t.focus()})}t.$inject=["$scope","$document","$timeout","$state","Scrolls","UtilsUi","Utils","Config","Status"],angular.module("app").controller("HelpCtrl",t)}(),function(){"use strict";function t(t){t.state("decks",{url:"/decks",views:{body:{templateUrl:"app/pages/decks/decks.html",controller:"DecksCtrl",controllerAs:"decksCtrl",resolve:{Decks:["Decks",function(t){return t.promise}]}},side:{templateUrl:"app/pages/decks/decks-left.html",controller:"LeftDecksCtrl",controllerAs:"leftCtrl"},bar:{templateUrl:"app/layout/bar.html"}},params:{search:null},scroll:!0})}t.$inject=["$stateProvider"],angular.module("app").config(t)}(),function(){"use strict";function t(t,e,s,n,r,o,a,i,c,l,u,d,p){function f(){var t=ScrollsTypes.AddDeck({deck:"New Deck"},!1,!1,!1,i.decks.length);i.decks.push(new ScrollsTypes.DeckExtended(ScrollsTypes._decks[t])),n.go("deck.new",{id:t})}function h(){v.destroyed=!0,a.fab=null}function g(t){n.go("deck.id",{id:t.id})}function m(){v.limit=35,C.lazy=[]}function y(t){if(!v.destroyed&&o[0]&&(!angular.isUndefined(t)||C.lazy.length)&&(C.selectedIndex===S&&c.sorted?c.sorted=d.sort(c.params.sort,c.sorted):w?(c.sorted=d.sort(w,o[C.selectedIndex]),c.sorted=d.sort(c.params.sort,c.sorted)):c.sorted=d.sort(c.params.sort,o[C.selectedIndex]),c.items=d.filter(c.sorted,c.params,c.text),S=C.selectedIndex,w=c.params.sort,v.si=t||C.selectedIndex,c.stats=o.stats[C.selectedIndex],u.setNext(C,v,c))){var e=u.getPagingIteration(C,c,v,r);v.running||e()}}function k(t,e){(""!==t&&null!==t||e)&&(m(),C.paging(C.selectedIndex))}var C=this,v={running:!1,destroyed:!1},S=0,w=null;this.selectedIndex=0,this.selectedIndexCopy=0,this.selectedIndexChanged=p.getTabDelay(C,k),this.paging=y,this.settingsCopy=l.settingsCopy,this.openDeck=g,this.addDeck=f,this.filter=c,this.myScrolls=i.cards,c.items=null,c.sorted=null,p.setTitle("Decks"),t.$on("$destroy",h),e(function(){a.fab={"class":"mdi-plus",click:f}},400),e(function(){var t=s[0].getElementById("page-content");t.focus()}),t.$watch(function(){return i.decks},k),t.$watch(function(){return c.params},k,!0),t.$watch(function(){return c.text.search},k),c.text.search=n.params.search}t.$inject=["$scope","$timeout","$document","$state","quickRepeatList","Decks","Status","Storage","FilterDecks","Settings","UtilsPaging","UtilsDecks","UtilsUi"],angular.module("app").controller("DecksCtrl",t)}(),function(){"use strict";function t(t){this.filter=t}t.$inject=["FilterDecks"],angular.module("app").controller("LeftDecksCtrl",t)}(),function(){"use strict";function t(t){t.state("deck",{url:"/deck","abstract":!0,views:{body:{templateUrl:"app/pages/deck/deck.html",controller:"DeckCtrl",controllerAs:"cardsCtrl",resolve:{Decks:["Decks",function(t){return t.promise}],Cards:["Cards",function(t){return t.promise}]}},side:{templateUrl:"app/pages/deck/deck-left.html",controller:"LeftDeckCtrl",controllerAs:"ct",resolve:{Scrolls:["Scrolls",function(t){return t.promise}],Cards:["Cards",function(t){return t.promise}]}},bar:{templateUrl:"app/layout/bar.html"}},scroll:!0,pinCard:!0}).state("deck.import",{url:"?types&deck&author&origin&version",params:{types:null,deck:null,author:null,origin:null,version:null},scroll:!0,pinCard:!0}).state("deck.id",{url:"/:id",scroll:!0,pinCard:!0}).state("deck.new",{url:"/:id",scroll:!0,pinCard:!0})}t.$inject=["$stateProvider"],angular.module("app").config(t)}(),function(){"use strict";function t(t,e,s,n,r,o,a,i,c,l,u,d,p,f){function h(t){t.target.select()}function g(){ScrollsTypes.RemoveDeck(F.deck),f.decks.splice(f.decks.indexOf(F.deck.storageId),1),o.go("decks")}function m(){}function y(){F.cloning||(F.cloning=!0,s(function(){var t=ScrollsTypes.AddDeck(F.deck,!1,!1,!0,f.decks.length);ScrollsTypes.CountScrollsDecks(),ScrollsTypes.GetDecksStats(),F.selectedIndex=0,F.selectedIndexCopy=0,f.decks.push(new ScrollsTypes.DeckExtended(ScrollsTypes._decks[t])),o.go("deck.id",{id:t})},0))}function k(){var t=a.confirm().theme(u.settings.dark?"dark":"default").title("Import deck").content("Duplicated deck import detected, do you want to open existing or import anyway?").cancel("Open").ok("Import");return delete t._options.template,t._options.templateUrl="app/shared/views/dialog.html",t._options.clickOutsideToClose=!0,t._options.ariaLabel=t._options.title,a.show(t)}function C(t){var e=ScrollsTypes.AddDeck(t,!1,!1,!1,f.decks.length);ScrollsTypes.CountScrollsDecks(),ScrollsTypes.GetDecksStats(),f.decks.push(new ScrollsTypes.DeckExtended(ScrollsTypes._decks[e])),o.go("deck.id",{id:e})}function v(){if(F.cloning=!1,o.params.types){var t=new ScrollsTypes.DeckExtended(o.params),e=ScrollsTypes.GetDeckByHash(t.getDeckHash());e?k().then(function(){C()},function(){o.go("deck.id",{id:e.id})}):C(t)}else o.params.id&&c.getDeck(o.params.id,function(t){t&&(F.deck=t,F.deck.deck&&p.setTitle("Deck:",F.deck.deck),I(),B(),q.resolve(),L())});s(function(){var t=r[0].getElementById("page-content");t.focus()})}function S(){w(),x()}function w(){p.setTitle("Deck:",F.filter.deck.deck||"?")}function $(){try{var t=angular.fromJson(F.filter.json);F.filter.error.invalidJson=!1;var e=new ScrollsTypes.DeckExtended(t);z.replaceDeck(e),w(),l.stats=z.cards[0].s}catch(s){F.filter.error.invalidJson=!0}}function T(){x()}function D(){x()}function x(){I(),A()}function b(t){o.go("decks",{search:t})}function I(){F.filter.deck=F.deck,F.params=F.deck.toDeckSimple(),F.filter.json=angular.toJson(F.params),F.params.origin=F.deck.origin,F.params.types=F.params.types.join(",");var t=angular.element("<a>")[0];t.href=n.location.href,t.hash=o.href("deck.import",F.params).replace(/%2C/g,","),F.share=t.href}function R(){O.destroyed=!0}function A(){F.deck.storageId&&(F.deck.storageId=f.decks[f.decks.indexOf(F.deck.storageId)]=new ScrollsTypes.DeckExtended(F.deck))}function P(t,e,n){t.stopPropagation&&t.stopPropagation();var r=z.addType(e);r&&(A(),n||(n=_.find(F.lazy,function(t){return t.s.id===e})),n?n.c++:(l.items=l.sorted=z.cards[F.selectedIndex].c,F.lazy=_.take(F.filter.items,F.lazy.length+1),s(function(){i.items(F.lazy)},0)),l.stats=z.cards[F.selectedIndex].s)}function U(t,e,n){t.stopPropagation(),z.removeType(e),n.c--,A(),0===n.c&&(l.items=l.sorted=z.cards[F.selectedIndex].c,F.lazy=_.take(F.filter.items,F.lazy.length-1),s(function(){i.items(F.lazy)},0)),l.stats=z.cards[F.selectedIndex].s}function E(){O.limit=35,F.lazy=[],l.lazy=F.lazy}function j(t){if(!O.destroyed&&z&&z.cards&&z.cards[0]&&(!angular.isUndefined(t)||F.lazy.length)&&(l.items=l.sorted=z.cards[F.selectedIndex].c,O.si=t||F.selectedIndex,l.stats=z.cards[F.selectedIndex].s,d.setNext(F,O,l))){var e=d.getPagingIteration(F,l,O,i);O.running||e()}}function L(){return I(),F.selectedIndex>2?(E(),void q.promise.then(function(){l.stats=z.cards[0].s})):void q.promise.then(function(){E(),l.stats=z.cards[F.selectedIndex].s,F.paging(F.selectedIndex)})}function B(){l.deckCards=z=new ScrollsTypes.DeckCards(F.deck)}var z,F=this,O={destroyed:!1,running:!1},q=e.defer();this.settingsCopy=u.settingsCopy,this.paging=j,this.showCard=p.showCard,this.minus=U,this.plus=P,this.selectedIndex="deck.new"===o.current.name?3:0,this.selectedIndexCopy="deck.new"===o.current.name?3:0,this.selectedIndexChanged=p.getTabDelay(F,L),this.filter=l,this.search=b,this.deleteDeck=g,this.resetDeck=m,this.cloneDeck=y,this.selectAll=h,this.focusData="deck.new"===o.current.name,this.inputDeckChanged=S,this.inputDataChanged=$,this.inputAuthorChanged=T,this.inputOriginChanged=D,this.filter.error={invalidJson:!1},p.setTitle("Deck"),l.sorted=null,l.edit=!1,t.$on("$destroy",R),t.$on("$stateChangeSuccess",v),t.$on("addType",P)}t.$inject=["$scope","$q","$timeout","$window","$document","$state","$mdDialog","quickRepeatList","Decks","FilterDeck","Settings","UtilsPaging","UtilsUi","Storage"],angular.module("app").controller("DeckCtrl",t)}(),function(){"use strict";function t(t,e,s,n,r,o,a,i,c,l,u){function d(e){t.$broadcast("addType",e.s.id)}function p(){v.selectedIndex=1,u.fab=null}function f(){T&&e(function(){1!==v.selectedIndex?u.fab={"class":"mdi-pencil",click:p}:u.fab=null}),T=!0,$()}function h(t,e,n){w(t,e,n),s.go("cards")}function g(t,e){t!==e&&k()}function m(t,e){t!==e&&k()}function y(){function t(){v.related&&8>s&&v.related.length<C.length?(S=!0,e(function(){v.related.push(C[v.related.length]),s++,t()},20)):S=!1}var s=0;1!==v.selectedIndexCopy||S||t()}function k(){v.filter.edit=1===v.selectedIndex,C=l.filter(r[0].c,o.params,o.text,n),v.related=_.take(C,15)}var C,v=this,S=!1,w=i.setFilter(a),$=c.getTabDelay(v,k),T=!1;this.filter=o,this.showResource=!0,this.edit=!0,this.status=u,this.showCard=c.showCard,this.selectedIndex=0,this.selectedIndexCopy=0,this.selectedIndexChanged=f,this.deckPaging=y,this.setFilter=h,this.addCard=d,this.filterParams=i.filterParams,o.querySearch=i.query(o,r[0].c,r[0].s),t.$watch(function(){return o.params},m,!0),t.$watch(function(){return o.text.search},g),"deck.new"===s.current.name?(this.selectedIndex=1,this.selectedIndexCopy=1,k()):e(function(){u.fab={"class":"mdi-pencil",click:p}},400)}t.$inject=["$rootScope","$timeout","$state","Bookmarks","Cards","FilterDeck","FilterCards","FilterUtils","UtilsUi","UtilsCards","Status"],angular.module("app").controller("LeftDeckCtrl",t)}(),function(){"use strict";function t(t){t.state("card",{url:"/scroll",views:{body:{templateUrl:"app/pages/card/card.html",controller:"CardCtrl",controllerAs:"ct",resolve:{ScrollsDecks:["ScrollsDecks",function(t){return t.promise}],Cards:["Cards",function(t){return t.promise}]}},side:{templateUrl:"app/pages/card/card-left.html"},bar:{templateUrl:"app/pages/card/card-bar.html",controller:"LeftCardBookmarksCtrl",controllerAs:"barCtrl"}}}).state("card.id",{url:"/:id"})}t.$inject=["$stateProvider"],angular.module("app").config(t)}(),function(){"use strict";function t(t,e,s,n,r,o,a,i,c,l,u,d,p){function f(t,e,s){C(t,e,s),n.go("cards")}function h(t,e){k.showCard(e)}function g(t){n.go("deck.id",{id:t.id})}function m(t){n.go("card.id",{id:t.s.id}),e(function(){u.add(t.s.id)},50)}function y(){if(n.params.id){var t=o.Scrolls.look[n.params.id];t&&(k.c=d.card={s:t},k.decks=_.values(t.decks),k.related=ScrollsTypes.RelatedCards(new ScrollsTypes.Card(t),a),c.setTitle("Scroll:","#"+n.params.id),e(function(){var e=s[0].getElementById("page-content");e.scrollTop=0,e.focus(),u.add(t.id)}))}}var k=this,C=i.setFilter(l);this.settingsCopy=angular.copy(p.settingsCardFull),this.filter=l,this.showCard=m,this.openDeck=g,this.setFilter=f,this.filterParams=i.filterParams,d.fab=null,t.$on("openCard",h),t.$on("$stateChangeSuccess",y),r("right-card").close(),c.setTitle("Scroll"),y()}t.$inject=["$rootScope","$timeout","$document","$state","$mdSidenav","ScrollsDecks","Scrolls","FilterUtils","UtilsUi","FilterCards","Recent","Status","Config"],angular.module("app").controller("CardCtrl",t)}(),function(){"use strict";function t(t,e,s){function n(e){t.$emit("openCard",e)}this.related=e.scrolls,this.showResource=!0,this.showCard=n,this.status=s}t.$inject=["$rootScope","Recent","Status"],angular.module("app").controller("LeftCardRecentCtrl",t)}(),function(){"use strict";function t(t,e,s){function n(e){t.$emit("openCard",e)}this.related=e.scrolls,this.look=e.look,this.set=e.set,this.status=s,this.showResource=!0,this.showCard=n}t.$inject=["$rootScope","Bookmarks","Status"],angular.module("app").controller("LeftCardBookmarksCtrl",t)}(),function(){"use strict";function t(t,e){e.otherwise("/scrolls"),t.state("cards",{url:"/scrolls",views:{body:{templateUrl:"app/pages/cards/cards.html",controller:"CardsCtrl",controllerAs:"cardsCtrl",resolve:{CardsDecks:["CardsDecks",function(t){return t.promise}]}},side:{templateUrl:"app/pages/cards/cards-left.html",controller:"LeftCardsCtrl",controllerAs:"ct"},bar:{templateUrl:"app/layout/bar.html"}},scroll:!0,pinCard:!0}).state("cards.filter",{url:"?resources&costs&star&search&kind&type&rarity&trait&set",scroll:!0,pinCard:!0}).state("cards.import",{url:"?types",scroll:!0,pinCard:!0})}t.$inject=["$stateProvider","$urlRouterProvider"],angular.module("app").config(t)}(),function(){"use strict";function t(t,e,s,n,r,o,a,i,c,l,u,d,p,f,h,g,m){function y(){e(function(){R.selectedIndex>0&&R.selectedIndex<3?p.fab={"class":"mdi-pencil",click:R.showProperties}:p.fab=null}),E()}function k(){R.filter=u,R.selectedIndex=0,R.selectedIndexCopy=0,R.selectedIndexChanged=y,R.paging=b,R.settingsCopy=f.settingsCopy,R.showCard=h.showCard,R.showProperties=$,R.setAllCards=w,R.resetCards=S,R.cardsParams={types:""},R.input={cards:angular.toJson(d.cards)},R.inputCards=v,h.setTitle("Scrolls"),u.items=null,u.sorted=null,v(!0);var t=s.search();if(t.types){var r=t.types.split(",");angular.forEach(r,function(t,e){r[e]=parseInt(t)}),C().then(function(){R.input.cards=angular.toJson({types:r})})}e(function(){var t=n[0].getElementById("page-content");t.focus()})}function C(){var t=r.confirm().theme(f.settings.dark?"dark":"default").title("Import scrolls collection").content("A scrolls collection has been shared with you, do you want to import?<br />Your current <em>My scrolls</em>  collection will be replaced.").cancel("Cancel").ok("Import");return delete t._options.template,t._options.templateUrl="app/shared/views/dialog.html",t._options.clickOutsideToClose=!0,t._options.ariaLabel=t._options.title,r.show(t)}function v(t){if(R.input.cards)try{var e=angular.fromJson(R.input.cards);t||d.set("cards",e),R.cardsParams.types=e.types.join(",")}catch(s){}}function S(){R.input.cards=angular.toJson({types:[]}),v()}function w(){l.promise.then(function(){var t=[];angular.forEach(l.parsed,function(e){t.push(e.id),t.push(e.id),t.push(e.id)}),R.input.cards=angular.toJson({types:t}),v()})}function $(){R.selectedIndex=3}function _(t,e){t!==e&&(I(),o.eventTrack("Cards",{category:"Search"}))}function T(t,e){t!==e&&(I(),o.eventTrack("Cards",{category:"Filter"}))}function D(){A.destroyed=!0}function x(){A.limit=35,R.lazy=[]}function b(t){if(!A.destroyed&&i.Cards[0]&&(!angular.isUndefined(t)||R.lazy.length)){if(R.selectedIndex>2)return void(P=R.selectedIndex);if(R.selectedIndex===P&&u.sorted?u.sorted=g.sort(u.params.sort,u.sorted):U?(u.sorted=g.sort(U,i.Cards[R.selectedIndex].c),u.sorted=g.sort(u.params.sort,u.sorted)):u.sorted=g.sort(u.params.sort,i.Cards[R.selectedIndex].c),u.items=g.filter(u.sorted,u.params,u.text,c),P=R.selectedIndex,U=u.params.sort,A.si=t||R.selectedIndex,u.stats=i.Cards[R.selectedIndex].s,!(R.lazy.length<A.limit-5&&R.lazy.length)){A.limit+=25,A.limit=A.limit>u.items.length?u.items.length:A.limit;var e=m.getPagingIteration(R,u,A,a);A.running||e()}}}function I(){x(),R.paging(R.selectedIndex),R.selectedIndex<3&&u.items.length!==u.sorted.length?h.setTitle("Scrolls:",u.items.length+" of "+u.sorted.length):h.setTitle("Scrolls")}var R=this,A={destroyed:!1,running:!1},P=0,U=null,E=h.getTabDelay(R,I);k(),p.fab=null,t.$on("$destroy",D),i.Cards.promise.then(I),t.$watch(function(){return d.cards},I),t.$watch(function(){return u.params},T,!0),t.$watch(function(){return u.text.search},_)}t.$inject=["$scope","$timeout","$location","$document","$mdDialog","$analytics","quickRepeatList","CardsDecks","Bookmarks","Scrolls","FilterCards","Storage","Status","Settings","UtilsUi","UtilsCards","UtilsPaging"],angular.module("app").controller("CardsCtrl",t)}(),function(){"use strict";function t(t,e,s,n,r,o){function a(){r.disabled=!0;var t=e.search();delete t.types,o.fromParams(t,r),n("right-card").close().then(function(){s(function(){s(function(){r.disabled=!1})})})}function i(t,e,s){c(t,e,s)}var c=o.setFilter(r);this.filter=r,this.setFilter=i,this.filterParams=o.filterParams,t.$on("$stateChangeSuccess",a)}t.$inject=["$scope","$location","$timeout","$mdSidenav","FilterCards","FilterUtils"],angular.module("app").controller("LeftCardsCtrl",t)}(),function(){"use strict";function t(t,e,s,n,r,o,a,i,c){function l(t){var s=r.alert().theme(c.settings.dark?"dark":"default").title("Import scrolls collection").ok("Ok");return delete s._options.template,s._options.templateUrl="app/shared/views/filter-search-help.html",s._options.parent=angular.element(e.body),s._options.targetEvent=t,s._options.clickOutsideToClose=!0,r.show(s)}function u(){n("right-settings").close(),n("right-card").close()}function d(){n("left").open()}function p(){n("left").close()}function f(t){s.show({templateUrl:"app/layout/bottom.html",targetEvent:t}).then(function(t){o.go(t)})}function h(e){n("right-settings").toggle().then(function(){angular.isDefined(e)&&t.$emit("settingsTab",e)}),a.eventTrack("Settings",{category:"Commands"})}function g(){n("right-settings").close()}function m(){n("right-card").close()}function y(){n("left").toggle()}this.state=o,this.openBottom=f,this.openRight=h,this.closeRight=g,this.closeRightCard=m,this.toggleLeft=y,this.status=i,this.mainSwipeRight=d,this.mainSwipeLeft=p,this.leftSwipeLeft=p,this.rightSwipeRight=u,this.settingsCopy=c.settingsCopy,this.filterHelp=l,this.pinCard=!1}t.$inject=["$rootScope","$document","$mdBottomSheet","$mdSidenav","$mdDialog","$state","$analytics","Status","Settings"],angular.module("app").controller("ToolbarCtrl",t)}(),function(){"use strict";function t(t){this.itemClick=function(e){t.hide(e)}}t.$inject=["$mdBottomSheet"],angular.module("app").controller("BottomCtrl",t)}(),function(){"use strict";angular.module("app.layout",["app.core"])}(),function(){"use strict";angular.module("app.filters",[])}(),function(){"use strict";function t(t,e){function s(t){return function(e,s){var n=t.params[e];s&&(s.ctrlKey||s.altKey)&&(t.params.g=n,t.params.e=n,t.params.o=n,t.params.d=n),t.params[e]=!n}}function n(t){return function(e,s){var n=t.params[e];s&&(s.ctrlKey||s.altKey)&&(t.params[1]=n,t.params[2]=n,t.params[3]=n,t.params[4]=n,t.params[5]=n,t.params[6]=n,t.params[7]=n,t.params[8]=n),t.params[e]=!n}}function r(t,e,s){var n=angular.copy(d),r=c(n);return r(t,e,s),a(n)}function o(t,e){angular.forEach(t,function(e,s){t[s]=decodeURIComponent(decodeURIComponent(e))});var s="none"===t.resources?"":t.resources?t.resources:l,n="none"===t.costs?"":t.costs?t.costs:u;
angular.forEach(l,function(t){e.params[t]=_.indexOf(s,t)>-1}),angular.forEach(u,function(t){e.params[t]=_.indexOf(n,t)>-1}),e.params.star=t.star||0,e.text.search=t.search||"",e.params.selectedItem=null,t.search||angular.forEach(t,function(t,s){"resources"!==s&&"costs"!==s&&"star"!==s&&"search"!==s&&t&&(e.params.selectedItem={},e.params.selectedItem.name="set"===s?"Set "+t:t,e.params.selectedItem[s]="set"===s?parseInt(t):!0,e.text.search=e.params.selectedItem.name)})}function a(t){var e=0,s=0,n={resources:null,costs:null,star:null,search:null,kind:null,type:null,trait:null,rarity:null,set:null};return angular.forEach(l,function(s){e+=t.params[s]}),angular.forEach(u,function(e){s+=t.params[e]}),0===e?n.resources="none":4>e&&(n.resources="",angular.forEach(l,function(e){n.resources+=t.params[e]?e:""})),0===s?n.costs="none":8>s&&(n.costs="",angular.forEach(u,function(e){n.costs+=t.params[e]?e:""})),t.params.star&&(n.star=t.params.star),t.params.selectedItem?(angular.forEach(t.params.selectedItem,function(e,s){e===!0&&(n[s]=t.params.selectedItem.name)}),n.set=t.params.selectedItem.set||null):t.text.search&&(n.search=t.text.search),n}function i(s,n,r){return function(o){if(!o||s.disabled)return[];if(s.params.selectedItem&&s.params.selectedItem.name===o)return[s.params.selectedItem];n=n||s.sorted,r=r||s.stats,o=o.toLowerCase();var a=e.defer();return t(function(){var t=[],e=[],s=["CREATURE","ENCHANTMENT","SPELL","STRUCTURE"],i=["Common","Uncommon","Rare"],c=[],l=[],u=[],d=[],p=[],f={};_.each(s,function(t){var e=t.toLowerCase().indexOf(o);0===e&&c.push({name:t,kind:!0})}),_.each(i,function(t){var e=t.toLowerCase().indexOf(o);0===e&&c.push({name:t,rarity:!0})}),r&&r.type&&_.each(r.type.total,function(t){var e=t[0].toLowerCase().indexOf(o);0===e&&l.push({name:t[0],type:!0})}),r&&r.trait&&_.each(r.trait.total,function(t){var e=t[0].toLowerCase().indexOf(o);0===e&&u.push({name:t[0],trait:!0})}),_.each(n,function(s){var n=s.s.nameLowerCase.indexOf(o);f[s.s.set]=!0,-1!==n&&(0===n?t.push({name:s.s.name,card:s}):e.push({name:s.s.name,card:s}))}),_.each(f,function(t,e){var s="Set "+e,n=s.toLowerCase().indexOf(o);n>-1&&p.push({name:s,set:parseInt(e)})}),t=_.sortBy(t,"name"),e=_.take(_.sortBy(e,"name"),e.length<25?e.length:25);var h=p.concat(c).concat(d).concat(l).concat(u).concat(t).concat(e);a.resolve(h)}),a.promise}}function c(t){return function(e,s,n){var r=0;if(s=_.isNumber(s)&&0!==s?s.toString():s,"cost"===e)r=s,t.params.selectedItem=null,t.text.search=null;else if("?"===e)t.text.search=s||"";else{var o={name:s};e&&(o[e]=!0,t.params.selectedItem=o),t.text.search=s||"","set"===e&&s&&(t.text.search=o.name="Set "+s,o[e]=parseInt(s))}for(var a=1;8>=a;a++)t.params[a]=!r||r===a.toString();n=n||"total",t.params.g="r0"===n||"total"===n,t.params.e="r1"===n||"total"===n,t.params.o="r2"===n||"total"===n,t.params.d="r3"===n||"total"===n,angular.isUndefined(e)&&(t.params.star=0)}}var l="geod",u="12345678",d={text:{},params:{}};return{toParams:a,fromParams:o,query:i,setFilter:c,filterParams:r,setResource:s,setCost:n,resources:{g:!0,e:!0,o:!0,d:!0},costs:{1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},dummy:d}}t.$inject=["$timeout","$q"],angular.module("app.filters").factory("FilterUtils",t)}(),function(){"use strict";function t(t){var e={};return e.text={search:""},e.params=angular.extend({sort:"name",selectedItem:null},t.resources),e.querySearch=function(){return[]},e.setResource=t.setResource(e),e}t.$inject=["FilterUtils"],angular.module("app.filters").factory("FilterDecks",t)}(),function(){"use strict";function t(t){var e={};return e.text={search:""},e.params=angular.extend({star:0,selectedItem:null},t.resources,t.costs),e.setResource=t.setResource(e),e.setCost=t.setCost(e),e}t.$inject=["FilterUtils"],angular.module("app.filters").factory("FilterDeck",t)}(),function(){"use strict";function t(t){var e={};return e.text={search:""},e.params=angular.extend({star:0,sort:"cost",selectedItem:null},t.resources,t.costs),e.querySearch=t.query(e),e.setResource=t.setResource(e),e.setCost=t.setCost(e),e}t.$inject=["FilterUtils"],angular.module("app.filters").factory("FilterCards",t)}(),function(){"use strict";angular.module("app.data",["ngResource","app.services"])}(),function(){"use strict";function t(t,e,s){var n=t.defer();return t.all([e.$promise,s.promise]).then(function(t){ScrollsTypes._scrolls=new ScrollsTypes.Scrolls(t[0],s.webp),angular.extend(n,ScrollsTypes._scrolls),n.resolve(n)}),n}t.$inject=["$q","ScrollsResource","WebP"],angular.module("app.data").factory("Scrolls",t)}(),function(){"use strict";function t(t){return t("./data/scrolls-42ea5b70.json").get()}t.$inject=["$resource"],angular.module("app.data").factory("ScrollsResource",t)}(),function(){"use strict";function t(t,e,s){var n=t.defer(),r=8;return n.types=e.recent,n.scrolls=[],s.promise.then(function(){angular.forEach(n.types,function(t){n.scrolls.push({s:s.look[t]})}),n.resolve(n)}),n.add=function(t){n.promise.then(function(){var e=n.types.indexOf(t);if(e>=0&&(n.types.splice(e,1),n.scrolls.splice(e,1)),(e>=0||-1===e)&&(n.types.unshift(t),n.scrolls.unshift({s:s.look[t]})),n.types.length>r){var o=n.types.length-r;n.types.splice(r,o),n.scrolls.splice(r,o)}})},n.reset=function(){n.types.splice(0,n.types.length),n.scrolls.splice(0,n.scrolls.length)},n}t.$inject=["$q","Storage","Scrolls"],angular.module("app.data").factory("Recent",t)}(),function(){"use strict";function t(t,e,s,n,r,o){function a(){e.$watch(function(){return o[1].c},function(){angular.extend(l,ScrollsTypes._decksCategorized),l.decks=ScrollsTypes._decks,ScrollsTypes.ResetDecks(),ScrollsTypes.AddDecks(n.starters,!0,!0),ScrollsTypes.AddDecks(n.preconstructed,!0,!0),ScrollsTypes.AddDecks(n.users,!0),ScrollsTypes.AddDecks(n.test),ScrollsTypes.AddStoredDecks(s.decks),ScrollsTypes.CountScrollsDecks(),l.stats=ScrollsTypes.GetDecksStats(),l.resolve(l)})}function i(t,e){l.promise.then(function(){e(l.decks[t])})}function c(t){ScrollsTypes.RemoveDeck(t),l.stats=ScrollsTypes.GetDecksStats()}var l=t.defer();return l.getDeck=i,l.removeDeck=c,t.all([r.promise,o.promise,n.$promise]).then(a),l}t.$inject=["$q","$rootScope","Storage","DecksResource","Scrolls","Cards"],angular.module("app.data").factory("Decks",t)}(),function(){"use strict";function t(){function t(t){return{types:t.types.join(","),deck:t.deck,author:t.author,origin:t.origin}}return{deckParams:t}}angular.module("app.data").factory("DecksUtils",t)}(),function(){"use strict";function t(t){return t("./data/decks-f4c2e6af.json").get()}t.$inject=["$resource"],angular.module("app.data").factory("DecksResource",t)}(),function(){"use strict";function t(t,e,s){return s.getComboPromise({Decks:e,Scrolls:t})}function e(t,e,s){return s.getComboPromise({Cards:t,Decks:e})}t.$inject=["Scrolls","Decks","Utils"],e.$inject=["Cards","Decks","Utils"],angular.module("app.data").factory("CardsDecks",e),angular.module("app.data").factory("ScrollsDecks",t)}(),function(){"use strict";function t(t,e,s,n){var r=t.defer();return n.promise.then(function(){e.$watch(function(){return s.cards},function(){var t=s.cards&&s.cards.types;ScrollsTypes._cardsReport=new ScrollsTypes.CardsReport(t,n),angular.extend(r,ScrollsTypes._cardsReport),ScrollsTypes._typesCounts=new ScrollsTypes.TypesCounts(ScrollsTypes._cardsReport[1].c),r.resolve(r)})}),r}t.$inject=["$q","$rootScope","Storage","Scrolls"],angular.module("app.data").factory("Cards",t)}(),function(){"use strict";function t(t,e,s){var n=t.defer();return n.types=e.bookmarks,n.scrolls=[],n.look={},s.promise.then(function(){angular.forEach(n.types,function(t){n.scrolls.push({s:s.look[t]}),n.look[t]=!0}),n.resolve(n)}),n.set=function(t){n.promise.then(function(){if(n.look[t]){n.look[t]=!1;var e=n.types.indexOf(t);n.types.splice(e,1),n.scrolls.splice(e,1)}else n.look[t]=!0,n.types.unshift(t),n.scrolls.unshift({s:s.look[t]})})},n.reset=function(){n.types.splice(0,n.types.length),n.scrolls.splice(0,n.scrolls.length),angular.copy({},n.look)},n}t.$inject=["$q","Storage","Scrolls"],angular.module("app.data").factory("Bookmarks",t)}(),function(){"use strict";angular.module("app.core",["ngAnimate","ngSanitize","ngMessages","ui.router","ngMaterial","infinite-scroll","QuickList","angulartics","angulartics.google.analytics"])}(),function(){"use strict";function t(t){var e=!0;e?(t.definePalette("alt",t.extendPalette("blue-grey",{A100:"DFE7EB"})),t.definePalette("bg",t.extendPalette("blue-grey",{})),t.theme("default").backgroundPalette("alt").warnPalette("blue-grey").primaryPalette("bg").accentPalette("blue-grey",{"default":"600"})):(t.definePalette("light-bg",t.extendPalette("brown",{A100:"E8E8E8"})),t.definePalette("light-primary",t.extendPalette("brown",{500:"7A746C"})),t.definePalette("light-accent",t.extendPalette("brown",{500:"7A746C"})),t.theme("default").backgroundPalette("light-bg").warnPalette("brown").primaryPalette("light-primary").accentPalette("light-accent",{"default":"500"})),t.definePalette("alt-dark",t.extendPalette("grey",{800:"494744"})),t.definePalette("accent",t.extendPalette("amber",{500:"E0AA07"})),t.definePalette("alt-amber",t.extendPalette("amber",{500:"E0AA07"})),t.theme("dark").backgroundPalette("alt-dark").primaryPalette("alt-amber").accentPalette("accent").dark(),t.alwaysWatchTheme(!0)}t.$inject=["$mdThemingProvider"],angular.module("app.core").config(t)}(),function(){"use strict";function t(t){function e(t,e,s){function n(n,r){t(n,r),s.error(n,r),e.eventTrack(n.stack,{category:"Exception"})}return n}e.$inject=["$delegate","$analytics","$log"],t.decorator("$exceptionHandler",e)}t.$inject=["$provide"],angular.module("app").config(t)}(),function(){"use strict";function t(t){t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}t.$inject=["$compileProvider"],angular.module("app").config(t)}();var ScrollsTypes;!function(t){"use strict";var e=function(){function e(e,s,n){void 0===s&&(s=!1),void 0===n&&(n=!1);var r=new t.ResCountTotal,o=new t.ResCount,a=new t.ResCount,i=new t.ResCount,c=new t.ResCount,l=new t.ResCount,u=new t.ResCount,d=new t.ResCount,p=new t.ResCount;e.forEach(function(t){var e=s?t.c:1;if(t.s){var n=t.s.growth?"g":t.s.energy?"e":t.s.order?"o":"d",f=t.s.growth+t.s.energy+t.s.order+t.s.decay;o[n][f]=(o[n][f]||0)+e,o.total[f]=(o.total[f]||0)+e,r[n]=(r[n]||0)+e,r.total=(r.total||0)+e,a[n][t.s.kind]=(a[n][t.s.kind]||0)+e,a.total[t.s.kind]=(a.total[t.s.kind]||0)+e,i[n][t.s.rarity]=(i[n][t.s.rarity]||0)+e,i.total[t.s.rarity]=(i.total[t.s.rarity]||0)+e,t.s.typesArr.forEach(function(t){t&&(c[n][t]=(c[n][t]||0)+e,c.total[t]=(c.total[t]||0)+e)}),t.s.traits.forEach(function(t){t&&(l[n][t]=(l[n][t]||0)+1,l.total[t]=(l.total[t]||0)+1)}),("CREATURE"===t.s.kind||"STRUCTURE"===t.s.kind)&&(u[n][t.s.ap]=(u[n][t.s.ap]||0)+1,u.total[t.s.ap]=(u.total[t.s.ap]||0)+1,d[n][t.s.ac]=(d[n][t.s.ac]||0)+1,d.total[t.s.ac]=(d.total[t.s.ac]||0)+1,p[n][t.s.hp]=(p[n][t.s.hp]||0)+1,p.total[t.s.hp]=(p.total[t.s.hp]||0)+1)}});for(var f=n?8:parseInt(_.max(_.keys(o.total),function(t){return parseInt(t,10)}),10),h=1;f>=h;h++)o.g[h]=o.g[h]||"",o.e[h]=o.e[h]||"",o.o[h]=o.o[h]||"",o.d[h]=o.d[h]||"",o.total[h.toString()]=o.total[h];this.max=_.max(o.total),this.resources=_.keys(r).length-1,this.count=new t.ResCountSorted(o),this.kind=new t.ResCountSorted(a),this.rarity=new t.ResCountSorted(i),this.type=new t.ResCountSorted(c),this.trait=new t.ResCountSorted(l),this.total=new t.ResCountSorted(r),this.attack=new t.ResCountSorted(u,!0),this.counter=new t.ResCountSorted(d,!0),this.health=new t.ResCountSorted(p,!0),t.toSortedArray(this.type),t.toSortedArray(this.trait)}return e}();t.Stats=e}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";var e=function(){function e(s,n){var r=this;void 0===n&&(n=!1),this.parsed=[],this.look={},this.kinds={},this.types={},this.modified=new Date(s.modified),this.version=s.version,e.initResources(this.kinds),e.initResources(this.types),s.types.forEach(function(e){var o=new t.Scroll(e,s,n);r.parsed.push(o),r.look[o.id]=o,r.kinds[o.r][o.kind]=r.kinds[o.r][o.kind]||[],r.kinds[o.r][o.kind].push(o),o.typesArr.forEach(function(t){r.types[o.r][t]=r.types[o.r][t]||[],r.types[o.r][t].push(o)})})}return e.initResources=function(e){e[t.Resource[0]]={},e[t.Resource[1]]={},e[t.Resource[2]]={},e[t.Resource[3]]={}},e}();t.Scrolls=e}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";function e(t,e){return void 0===e&&(e=!1),t&&t.replace(/\\n/g,"\n").trim().replace(/\.\.\./g,"&hellip;").replace(/(<[^>]+)\\n([^>]+>)/g,"$1 $2").replace(/\[([^\]]+)]/g,"<b>$1</b>").replace(/\.\n/g,".<br />").replace(/\n/g,e?" ":"<br />")}function s(t){return t&&t.replace(/"([^"]+)"/g,"&ldquo;$1&rdquo;").replace(/-/g,"&mdash;")}function n(t,e){return t&&t.replace(/<([^>]+)>/g,function(t,s){var n=s.replace(/\\n/g," "),r=_.find(e,function(t){return 0===n.indexOf(t.name)}).id;return'<a href="./#/scroll/'+r+'">'+n+"</a>"})}function r(t){return t&&t.replace(/<([^>]+)>/g,"<b>$1</b>")}function o(t){var e=/^[^:\d]+/,s=t[0].match(e),n=s[0].trim();return n[0].toUpperCase()+n.substr(1)}function a(t){for(var e={},s=/\[([^\]]+)]/g,n=s.exec(t);null!==n;)e[n[1].toLowerCase()]=!0,n=s.exec(t);return e}function i(t){if(!t.match)return t;var e=/^[^:\d]+/,s=t.match(e),n=_.trim(s[0]),r=n[0].toUpperCase()+n.substr(1).toLowerCase(),o=new RegExp("^"+n);return[n,r,t.replace(o,"")]}!function(t){t[t.g=0]="g",t[t.e=1]="e",t[t.o=2]="o",t[t.d=3]="d"}(t.Resource||(t.Resource={}));var c=t.Resource;!function(t){t[t.Common=0]="Common",t[t.Uncommon=1]="Uncommon",t[t.Rare=2]="Rare"}(t.Rarity||(t.Rarity={}));var l=t.Rarity,u=function(){function t(t,u,d){void 0===d&&(d=!1),this.decks={},this.decksCount=0;var p=t.types.split(",");p=p.length&&!p[0]?[]:p,t.img=t.img||"",this.id=t.id,this.name=t.name,this.nameLowerCase=t.name.toLowerCase(),this.flavor=s(e(t.flavor)),this.description=e(r(t.desc),!0),this.descriptionLink=e(n(t.desc,u.types),!0),this.rarity=t.rarity,this.rarityText=l[t.rarity],this.kind=t.kind,this.types=p.join(", "),this.typesArr=p,this.energy=t.energy,this.growth=t.growth,this.order=t.order,this.decay=t.decay,this.cost=t.growth+t.energy+t.order+t.decay,this.ri=t.growth?0:t.energy?1:t.order?2:3,this.r=c[this.ri],this.ap=t.ap,this.ac=t.ac,this.hp=t.hp,this.hp=t.hp,this.set=t.set,this.price=t.price||0,this.L="0px "+(-144*t.img-1)+"px",this.M="0px "+(-63*t.img-1)+"px",this.S="-10px "+(-48*t.img-1)+"px",this.Lc=(d?"app-art-webp-":"app-art-")+"l-"+this.r,this.Mc=(d?"app-art-webp-":"app-art-")+"m-"+this.r,this.Sc=(d?"app-art-webp-":"app-art-")+"s-"+this.r,this.bundle=t.bundle,this.traits=t.rules.map(o),this.rules=t.rules.map(function(t){return{name:e(t[0])}});var f=a(t.desc),h={};_.each(f,function(t,e){u.strings[e]&&(h[e]=u.strings[e])});var g=a(t.rules);_.each(g,function(t,e){u.strings[e]&&(h[e]=u.strings[e])}),_.each(t.rules,function(t){if(t&&(h[t[0].toLowerCase()]=t,t[0]=e(t[0]),t[1].indexOf("${AMOUNT}")>-1)){var s=/^[^\d]+(\d)/.exec(t[0]);t[1]=t[1].replace("${AMOUNT}",s&&s[1]||"amount")}}),this.terms=_.pairs(h),this.traits=_.uniq(this.traits.concat(_.map(this.terms,o))),_.each(this.terms,function(t){t[1][0]=i(t[1][0])}),this.p=0!==this.ap||0!==this.ac||0!==this.hp,this.ac=-1===this.ac?"—":this.ac}return t.prototype.updateDecksCount=function(){this.decksCount=_.keys(this.decks).length},t}();t.Scroll=u}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";function e(t){var e="total",s=t[e],n=[];_.each(s,function(t,e){n.push([e,t])}),n.sort(),t[e]=n}t.toSortedArray=e;var s=function(){function t(t,e){void 0===e&&(e=!1),this.r0=t.g,this.r1=t.e,this.r2=t.o,this.r3=t.d,this.total=t.total,e&&(this.getLimits(),this.fixRange())}return t.prototype.getLimits=function(){var t=0,e=0,s=1/0;_.each(this.total,function(n,r){var o=parseInt(r,10)||0;t=Math.max(t,o),e=Math.max(e,n),s=Math.min(s,o)}),this.max=e,this.min=s,this.range=t},t.prototype.fixRange=function(){var t=this;_.each(t,function(e){if(e&&_.isObject(e)){for(var s=t.total["—"]?1:t.min;s<=t.range;s++)e[s]=e[s]||"";t.total["—"]&&(e["—"]=e["—"]||"")}})},t}();t.ResCountSorted=s}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";var e=function(){function t(){this.g={},this.e={},this.o={},this.d={},this.total={}}return t}();t.ResCount=e;var s=function(){function t(){this.g=0,this.e=0,this.o=0,this.d=0,this.total=0}return t}();t.ResCountTotal=s}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";t._scrolls,t._cardsAndStats,t._typesCounts,t._cardsReport,t._allDecksStats=[],t._decks=[],t._decksCategorized=[t._decks,[],[]],t._decksStats=[{},{},{}]}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";function e(t,e,s){void 0===e&&(e=!1),void 0===s&&(s=!1),_.each(t,function(t){r(t,e,s)})}function s(t){_.each(t,function(t){r(t,!1,!1,!1,t)})}function n(e){return _.find(t._decks,function(t){return t.hash===e})}function r(e,s,n,r,a){void 0===s&&(s=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=null);var i=new t.Deck(e,s,n,a);return r&&(i.deck="Clone of "+i.deck),t._decks.push(i),o(i),i.id}function o(e){t._decksStats[0][e.code]=(t._decksStats[0][e.code]||0)+1,e.have===e.types.length?(t._decksStats[1][e.code]=(t._decksStats[1][e.code]||0)+1,t._decksCategorized[1].push(e)):(t._decksStats[2][e.code]=(t._decksStats[2][e.code]||0)+1,t._decksCategorized[2].push(e))}function a(e){t._decks[e.id]=null,e.types.forEach(function(s){var n=t._scrolls.look[s];n&&(delete n.decks[e.id],n.updateDecksCount())}),i(e),l()}function i(e){t._decksStats[0][e.code]--,t._decksStats[0][e.code]||delete t._decksStats[0][e.code],t._decksStats[1][e.code]?(t._decksStats[1][e.code]--,t._decksStats[1][e.code]||delete t._decksStats[1][e.code],t._decksCategorized[1].splice(t._decksCategorized[1].indexOf(e),1)):(t._decksStats[2][e.code]--,t._decksStats[2][e.code]||delete t._decksStats[2][e.code],t._decksCategorized[2].splice(t._decksCategorized[2].indexOf(e),1))}function c(t){return _.sortBy(_.map(t,function(t,e){var s=parseInt(e,10);return{count:t,val:s,g:8&s,e:4&s,o:2&s,d:1&s}}),"count").reverse()}function l(){return t._allDecksStats[0]=c(t._decksStats[0]),t._allDecksStats[1]=c(t._decksStats[1]),t._allDecksStats[2]=c(t._decksStats[2]),t._allDecksStats}function u(){_.each(t._scrolls.look,function(t){t.updateDecksCount()})}function d(){_.remove(t._decksCategorized[0]),_.remove(t._decksCategorized[1]),_.remove(t._decksCategorized[2])}t.AddDecks=e,t.AddStoredDecks=s,t.GetDeckByHash=n,t.AddDeck=r,t.addDeckStats=o,t.RemoveDeck=a,t.removeDeckStats=i,t.GetDecksStats=l,t.CountScrollsDecks=u,t.ResetDecks=d}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";var e=function(){function e(t){this.cards=[],this.deck=t,this.update()}return e.prototype.update=function(){var e=t.TypesToCards(this.deck.types,t._scrolls),s=t.HavingMissingRemainingCards(t._cardsReport[1].c,e);this.cards[0]=new t.CardsAndStats(s[0],!0,!0),this.cards[1]=new t.CardsAndStats(s[1],!0,!0),this.cards[2]=new t.CardsAndStats(s[2],!0,!0)},e.prototype.addType=function(e){t.removeDeckStats(this.deck);var s=this.deck.addType(e);return this.update(),t.addDeckStats(this.deck),t.GetDecksStats(),s},e.prototype.removeType=function(e){t.removeDeckStats(this.deck);var s=this.deck.removeType(e);return this.update(),t.addDeckStats(this.deck),t.GetDecksStats(),s},e.prototype.replaceDeck=function(t){this.deck.deck=t.deck,this.deck.author=t.author,this.deck.origin=t.origin,this.replaceTypes(t.types)},e.prototype.replaceTypes=function(e){var s=this;t.removeDeckStats(this.deck),_.each(_.clone(this.deck.types),function(t){s.deck.removeType(t)}),_.each(e,function(t){s.deck.types.push(t)}),this.deck.update(),this.update(),t.addDeckStats(this.deck),t.GetDecksStats()},e}();t.DeckCards=e}(ScrollsTypes||(ScrollsTypes={}));var __extends=this.__extends||function(t,e){function s(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);s.prototype=e.prototype,t.prototype=new s},ScrollsTypes;!function(t){"use strict";var e=function(){function t(t){var e=this;if(t)if(this.deck=t.deck,this.author=t.author,_.isString(t.types)){this.types=[];var s=t.types.toString().split(",");_.each(s,function(t){e.types.push(parseInt(t,10))})}else this.types=t.types}return t.prototype.getDeckHash=function(){return _.sortBy(this.types).join(",")},t}();t.DeckSimple=e;var s=function(t){function e(e){e&&(t.call(this,e),this.origin=e.origin)}return __extends(e,t),e}(e);t.DeckExtended=s;var n=function(n){function r(e,s,r,o){void 0===o&&(o=null),n.call(this),this.origin=e.origin||(r?"http://scrolls.com":""),this.author=e.author,this.deck=e.deck,this.types=e.types||[],this.starter=s,this.id=t._decks.length,this.storageId=o,this.update()}return __extends(r,n),Object.defineProperty(r.prototype,"hash",{get:function(){return this.getDeckHash()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"deck",{get:function(){return this._deck},set:function(t){this._deck=t||"?",this.deckLowerCase=this._deck.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"author",{get:function(){return this._author},set:function(t){this._author=t||"?",this.authorLowerCase=this._author.toLowerCase()},enumerable:!0,configurable:!0}),r.prototype.update=function(){this.countTypes(),this.updatePricing(),this.updateSortString(),this.updateResourcePercents(),this.updateResourceFlags(),this.updateCode(),this.updateStats()},r.prototype.toDeckSimple=function(){return new e(this)},r.prototype.toDeckExtended=function(){return new s(this)},r.prototype.addType=function(t){var e=this.counts[t]||0;return 3>e?(this.types.push(t),this.counts[t]=e+1,this.update(),1):0},r.prototype.removeType=function(t){var e=this.counts[t]||0;return e>1?(this.counts[t]=e-1,this.types.splice(this.types.indexOf(t),1),this.update(),1):e>0?(delete this.counts[t],this.types.splice(this.types.indexOf(t),1),this.update(),1):0},r.prototype.countTypes=function(){var e=this;this.counts={},this.growth=0,this.order=0,this.energy=0,this.decay=0,this.types.forEach(function(s){var n=t._scrolls.look[s];n&&(e.growth+=n.growth?1:0,e.energy+=n.energy?1:0,e.decay+=n.decay?1:0,e.order+=n.order?1:0,n.decks[e.id]=e),e.counts[s]=(e.counts[s]||0)+1})},r.prototype.updatePricing=function(){var e=0,s=0,n=0;_.each(this.counts,function(r,o){var a=t._typesCounts.items[o]||0;e+=a>=r?r:a;var i=t._scrolls.look[o]?t._scrolls.look[o].price:0;n+=r*i,r>a&&(s+=(r-a)*i)}),this.havePercent=Math.floor(e/(this.types.length||1)*100),this.have=e,this.price=s,this.priceTotal=n},r.prototype.updateResourcePercents=function(){this.growthPercent=this.growth/(this.types.length||1)*100,this.energyPercent=this.energy/(this.types.length||1)*100,this.decayPercent=this.decay/(this.types.length||1)*100,this.orderPercent=this.order/(this.types.length||1)*100},r.prototype.updateSortString=function(){function t(t){return(10>t?"00":100>t?"0":"")+t}this.sort=t(this.growth)+t(this.energy)+t(this.order)+t(this.decay)},r.prototype.updateResourceFlags=function(){this.g=this.growth>0,this.e=this.energy>0,this.o=this.order>0,this.d=this.decay>0},r.prototype.updateCode=function(){this.code=(this.g?8:0)+(this.e?4:0)+(this.o?2:0)+(this.d?1:0)},r.prototype.updateStats=function(){var e=[];_.each(this.counts,function(s,n){e.push(new t.Card(t._scrolls.look[n],s))}),this.stats=new t.Stats(e,!0,!0)},r}(s);t.Deck=n}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";var e=function(){function e(e,s){this[0]=new t.CardsAndStats(t.ScrollsToCards(s.parsed)),this[1]=new t.CardsAndStats(t.TypesToCards(e,s)),this[2]=new t.CardsAndStats(t.MissingCards(this[1].c,s))}return e}();t.CardsReport=e}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";var e=function(){function e(e,s,n){void 0===s&&(s=!1),void 0===n&&(n=!1),this.c=e,this.s=new t.Stats(e,s,n)}return e}();t.CardsAndStats=e}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";function e(e,s){var n=[],r={};return _.each(e,function(e){s.look[e]&&(r[e]?r[e].c++:(r[e]=new t.Card(s.look[e],1),n.push(r[e])))}),n}function s(e){var s=[];return e.forEach(function(e){s.push(new t.Card(e,1))}),s}function n(e,s){var n=[],r={};return e.forEach(function(e){r[e.s.id]=new t.Card(e.s,3-e.c),r[e.s.id].c&&n.push(r[e.s.id])}),_.each(s.look,function(e,s){r[s]||n.push(new t.Card(e,3))}),n}function r(e,s,n){function r(s){o.length<n&&s!==e.s&&!_.find(o,function(t){return t.s===s})&&o.push(new t.Card(s))}void 0===n&&(n=25);var o=[];return _.each(_.clone(e.s.typesArr).reverse(),function(t){_.each(s.types[e.s.r][t],r)}),o.length||_.each(s.kinds[e.s.r][e.s.kind],r),o}function o(e,s){var n=[],r=[],o=[],a={};return _.each(e,function(e){var s=new t.Card(e.s,e.c);o.push(s),a[e.s.id]=s}),_.each(s,function(t){var e,s=a[t.s.id]?a[t.s.id].c:0,i=t.c;s>=i?(n.push({c:i,s:t.s}),e=s-i,e>0&&o.push({c:e,s:t.s})):0===s?r.push({c:i,s:t.s}):(n.push({c:s,s:t.s}),r.push({c:i-s,s:t.s}))}),[s,n,r,o]}var a=function(){function t(t){var e=this;this.items={},_.each(t,function(t){e.items[t.s.id]=t.c})}return t}();t.TypesCounts=a,t.TypesToCards=e,t.ScrollsToCards=s,t.MissingCards=n,t.RelatedCards=r,t.HavingMissingRemainingCards=o}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(t){"use strict";var e=function(){function t(t,e){void 0===e&&(e=1),this.s=t,this.c=e}return t}();t.Card=e}(ScrollsTypes||(ScrollsTypes={}));