!function(){"use strict";angular.module("app.services",["app.storage"])}(),function(){"use strict";function e(e,t){var s=e.defer(),n=new t.Image;return n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){s.webp=n.width>0&&n.height>0,s.resolve()},s}e.$inject=["$q","$window"],angular.module("app.services").factory("WebP",e)}(),function(){"use strict";function e(e){function t(t){var s=e.defer(),n=[];return angular.forEach(t,function(e){n.push(e.promise)}),e.all(n).then(function(){s.resolve(s)}),angular.extend(s,t),s}function s(e){var t=function(){window.SADurl="{URL}",window.SADversion=1,window.SADhome=window.SADurl+"#/deck",window.SADscript?window.SADloaded&&window.SADimport():(window.SADscript=document.createElement("script"),window.SADscript.src=window.SADurl+"import.js",document.getElementsByTagName("head")[0].appendChild(window.SADscript),window.SADloaded=!0)}.toString();return"("+t.replace(/\n/g," ").replace(/  +/g," ").replace("{URL}",e)+")()"}return{getComboPromise:t,bookmarklet:s}}e.$inject=["$q"],angular.module("app.services").factory("Utils",e)}(),function(){"use strict";function e(e,t,s,n){function r(e,n){n&&(n.ctrlKey||n.altKey)?s.go("card.id",{id:e.s.id}):t.$emit("showCard",e)}function o(t,s){return function(){e(function(){t.selectedIndexCopy!==t.selectedIndex&&(t.selectedIndexCopy=t.selectedIndex,s())},n.tabDelay)}}function a(e,s){t.title=e,t.subTitle=s,t.mainTitle=e+(s?" "+s:"")+" | Scrolls & Decks"}return{getTabDelay:o,setTitle:a,showCard:r}}e.$inject=["$timeout","$rootScope","$state","Config"],angular.module("app.services").factory("UtilsUi",e)}(),function(){"use strict";function e(e,t){function s(e,t,s){return e.lazy.length<t.limit-5&&e.lazy.length?!1:(t.limit+=25,t.limit=t.limit>s.items.length?s.items.length:t.limit,!0)}function n(s,n,r,o){function a(){if(r.si===s.selectedIndex)if(s.lazy.length<r.limit&&n.items[s.lazy.length]){var c,l;for(!s.lazy.length&&o.items&&o.items(s.lazy),s.lazy.length<20?(c=s.lazy.length+1,l=t.cardDelay):(c=s.lazy.length+4,c=c>n.items.length?n.items.length:c,l=t.cardBatchDelay);s.lazy.length<c;)s.lazy.push(n.items[s.lazy.length]);var u=(new Date).getTime(),d=u-i;i=u,d>l&&(l=t.cardMinDelay),e(function(){r.running=!1,r.destroyed||(o.items&&o.items(s.lazy),a())},l),r.running=!0}else r.running=!1}var i=(new Date).getTime();return a}return{setNext:s,getPagingIteration:n}}e.$inject=["$timeout","Config"],angular.module("app.services").factory("UtilsPaging",e)}(),function(){"use strict";function e(){function e(e,t){return"name"===e?_.sortBy(t,function(e){return e&&e.deck}):"author"===e?_.sortBy(t,function(e){return e&&e.author}):"resource"===e?_.sortBy(t,function(e){return e&&e.sort}).reverse():"cards"===e?_.sortBy(t,function(e){return e&&-e.havePercent}):"price"===e?_.sortBy(t,function(e){return e&&e.price}):t}function t(e,t,s){var n=s.search||"",r=n.toLowerCase();return _.filter(e,function(e){return e?e.types.length?t.g&&e.g||t.e&&e.e||t.o&&e.o||t.d&&e.d?r?e.deckLowerCase.indexOf(r)>-1||0===e.authorLowerCase.indexOf(r):!0:!1:!0:!1})}return{sort:e,filter:t}}angular.module("app.services").factory("UtilsDecks",e)}(),function(){"use strict";function e(){function e(e,t){return"name"===e?_.sortBy(t,function(e){return e.s.nameLowerCase}):"cost"===e?_.sortBy(t,function(e){return e.s.cost}):"resource"===e?_.sortBy(t,function(e){return e.s.ri}):"kind"===e?_.sortBy(t,function(e){return e.s.kind}):"type"===e?_.sortBy(t,function(e){return e.s.kind+e.s.types}):"decks"===e?_.sortBy(t,function(e){return-e.s.decksCount}):"cards"===e?_.sortBy(t,function(e){return-e.c}):"price"===e?_.sortBy(t,function(e){return e.s.price}):t}function t(e,t){var s=_.trim(e),n=parseInt(s);("-"===s||"—"===s)&&(n="—");var r=_.last(s);return"+"===r?t>=n:"-"===r?n>=t:"?"===r?!0:n===t}function s(e,t,s,r){var o,a=s.search||"",i=a.toLowerCase(),c=t.selectedItem||"";return c=c.name===a?c:null,_.filter(e,function(e){if(!t[e.s.cost]||!t[e.s.r])return!1;if(2===t.star&&r.look[e.s.id])return!1;if(1===t.star&&!r.look[e.s.id])return!1;if(!c){if(i){var s=/^[^\/]*\/[^\/]*\/[^\/]*$/g;return e.s.p&&s.test(i)?(o=i.split("/"),n.filterPoints(o[0],e.s.ap)&&n.filterPoints(o[1],e.s.ac)&&n.filterPoints(o[2],e.s.hp)):e.s.nameLowerCase.indexOf(i)>-1||e.s.id.toString()===i}return!0}return c.kind?e.s.kind===c.name:c.rarity?e.s.rarityText===c.name:c.type?e.s.typesArr.indexOf(c.name)>-1:c.trait?e.s.traits.indexOf(c.name)>-1:c.card?e.s===c.card.s:c.set?e.s.set===c.set:void 0})}var n={sort:e,filterPoints:t,filter:s};return n}angular.module("app.services").factory("UtilsCards",e)}(),function(){"use strict";angular.module("app.storage",["ngStorage"])}(),function(){"use strict";function e(e,t){function s(t,s){r[t]=s,e[t]=s}function n(t){t?angular.copy(o[t],e[t]):angular.extend(r,o)}var r={reset:n,set:s},o={bookmarks:[],recent:[],decks:[],cards:{},settings:t.settings},a=e.$default(o);return angular.extend(r,a),r}e.$inject=["$localStorage","Config"],angular.module("app.storage").factory("Storage",e)}(),function(){"use strict";function e(){return{card:null}}angular.module("app.services").factory("Status",e)}(),function(){"use strict";function e(e,t,s){function n(){t.reset("settings"),angular.copy(t.settings,o.settings),angular.copy(o.settings,o.settingsCopy)}function r(){e(function(){angular.extend(o.settingsCopy,o.settings),angular.extend(t.settings,o.settings)},s.settingsDelay)}var o={settings:angular.copy(t.settings),settingsCopy:angular.copy(t.settings),updateCopy:r,reset:n};return o}e.$inject=["$timeout","Storage","Config"],angular.module("app.services").factory("Settings",e)}(),function(){"use strict";function e(e){var t={image:!0,highlight:!1,decksHighlight:!0,decksAuthor:!0,decksScrolls:!0,decksChart:!0,animate:!0,mirror:!1},s={image:!0,highlight:!1,bundle:!1,name:!1,type:!1,rarity:!1,decks:!1,description:!1,flavor:!1},n={image:!0,rarity:!0,decks:!0,name:!0,type:!0,description:!0,flavor:!0,link:!0},r=".json";return{settingsDelay:450,tabDelay:650,cardDelay:25,cardBatchDelay:0,cardMinDelay:0,version:"0.5.1292",build:new Date("2015-05-18T06:23:20.120Z"),officialApp:"https://darosh.github.io/scrolls-and-decks/",repository:"https://github.com/darosh/scrolls-and-decks/",contentSource:"https://github.com/darosh/scrolls-and-decks/blob/master/client/data/scrolls"+r,license:"https://github.com/darosh/scrolls-and-decks/blob/master/LICENSE",issues:"https://github.com/darosh/scrolls-and-decks/issues",currentInstance:e.location.origin+e.location.pathname,settings:t,settingsCard:n,settingsCards:s,settingsCardFull:angular.extend(angular.copy(n),{terms:!0,link:!1,bundle:!0})}}e.$inject=["$window"],angular.module("app.services").factory("Config",e)}(),function(){"use strict";angular.module("app.directives",[])}(),function(){"use strict";function e(e,t){function s(s,n,r){var o=t(r.appFocus);s.$watch(o,function(t){t===!0&&e(function(){n[0].focus()})})}return{link:s}}e.$inject=["$timeout","$parse"],angular.module("app.directives").directive("appFocus",e)}(),function(){"use strict";function e(){function e(e,t,s){t.css("background-position",s.appArt)}return{link:e}}angular.module("app.directives").directive("appArt",e)}(),function(){"use strict";function e(e,t,s,n){function r(r,i,c){function l(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(n.innerHeight||s.documentElement.clientHeight)&&t.right<=(n.innerWidth||s.documentElement.clientWidth)}function u(){return r.$parent&&r.$parent.toolbarCtrl&&r.$parent.toolbarCtrl.settingsCopy.animate}function d(){function d(){function e(a){r.$$destroyed||a!==r.appAnimation||n.requestAnimationFrame(function(){if(!r.$$destroyed&&a===r.appAnimation){var c=(new Date).getTime(),d=g&&!!$.animations.attack,f=d?$.animations.attack:$.animations.idle;s||(s=c),d&&!m&&(s=c,m=!0,i.addClass("app-wait"));var h=Math.round((c-s)/(1e3/t));h>=f.length&&m&&(s=c,f=$.animations.idle,m=!1,g=!1,h=0,i.removeClass("app-wait"));var k=u()&&y(),C=l(p),v=k&&C?1e3/30:1e3/3,w=h%f.length;(C||0===h)&&(w===o||!k&&null!==o||(o=w,S(f[w]))),n.setTimeout(function(){e(a)},v)}})}var t=24,s=null;!c.appAnimationNoClick&&$.animations.attack&&i.addClass("app-animation-can-attack");var o=null;e(T)}function y(){var e=s[0].getElementsByTagName("md-backdrop");if(e.length){var t=_.find(e,function(e){return"none"!==n.getComputedStyle(e).display});return!t}return!0}function k(e){3===e.length&&e.splice(1,0,1,0,0,1);var t=$.sprites[e[0]],s=264*f+e[5]/(t[4]/t[2]),n=270*f+h+e[6]/(t[5]/t[3]);w.setTransform(e[1],e[2],e[3],e[4],s,n),w.drawImage(D,t[0],t[1],t[2],t[3],0,0,t[2],t[3])}function C(){return r.$parent&&r.$parent.toolbarCtrl&&r.$parent.toolbarCtrl.settingsCopy.dark}function v(){w.setTransform(1,0,0,1,0,0),w.clearRect(0,0,p.width,p.height);var e=.58*a.width,t=.58*a.height;w.globalAlpha=m?C()?.55:.32:C()?.28:.18,w.drawImage(a,0,0,a.width,a.height,(p.width-e)/2,328*f+h,e,t),w.globalAlpha=1}function S(e){v(),angular.forEach(e,k)}c.appAnimationNoClick||i.removeClass("app-animation-can-attack"),i.removeClass("app-wait");var w=p.getContext("2d");if(w.setTransform(1,0,0,1,0,0),w.clearRect(0,0,p.width,p.height),o.promise.then(function(){v()}),r.appAnimation){g=!1,m=!1;var $,T=r.appAnimation,D=new n.Image;n.setTimeout(function(){$=e("data/bundles/"+T+"/data.json",{},{get:{method:"GET",cache:!0}}).get();var s=t.defer();D.src="data/bundles/"+T+"/sprites.png",D.onload=function(){s.img=D,s.resolve(s)},t.all([$.$promise,o.promise,s.promise]).then(function(){n.setTimeout(d,0)})},0)}}var p=s[0].createElement("canvas"),f=1,h=0;p.width=530*f,p.height=490*f,i.append(p);var g=!1,m=!1;c.appAnimationNoClick||i.bind("click",function(){g=u()}),r.$watch("appAnimation",d)}var o=t.defer(),a=new n.Image;return a.src="images/unitstand-19c3af7a.png",o.img=a,a.onload=function(){o.resolve(o)},{link:r,scope:{appAnimation:"="}}}e.$inject=["$resource","$q","$document","$window"],angular.module("app.directives").directive("appAnimation",e)}(),function(){"use strict";angular.module("app.controllers",["app.services"])}(),function(){"use strict";function e(e){var t=this;t.selectedIndex=0,t.selectedIndexCopy=0,t.selectedIndexChanged=e.getTabDelay(t,angular.noop)}e.$inject=["UtilsUi"],angular.module("app.controllers").controller("TabsCtrl",e)}(),function(){"use strict";function e(e,t){function s(){angular.extend(e.settings,t.settingsCards),e.updateCopy()}function n(){var s=angular.copy(t.settingsCards);e.updateCopy(),angular.forEach(s,function(e,t){s[t]=!0}),angular.extend(e.settings,s),e.updateCopy()}var r=this;r.change=e.updateCopy,r.settings=e.settings,r.setAll=n,r.resetAll=s}e.$inject=["Settings","Config"],angular.module("app.controllers").controller("SettingsCtrl",e)}(),function(){"use strict";function e(){var e=this;e.ct={},e.toolbarCtrl={},e.leftCtrl={},e.cardsCtrl={},e.decksCtrl={},e.barCtrl={},e.filterParams={},e.setFilter={}}angular.module("app.controllers").controller("DummyCtrl",e)}(),function(){"use strict";angular.module("app.panels",["app.core","app.services","app.filters"])}(),function(){"use strict";function e(e,t,s,n,r,o,a,i){function c(){t(function(){s.screenfull.toggle()},i.settingsDelay)}function l(){o.reset()}function u(){a.reset()}function d(){r.reset("decks")}function p(){n.reset()}var f=this;f.resetDecks=d,f.resetSettings=p,f.resetBookmarks=u,f.resetRecent=l,f.fullScreen=c,f.fullScreenEnabled=s.screenfull.enabled,f.screenfull={isFullscreen:s.screenfull.isFullscreen},angular.element(s.document).on(s.screenfull.raw.fullscreenchange,function(){e.$apply(function(){f.screenfull.isFullscreen=s.screenfull.isFullscreen})})}e.$inject=["$scope","$timeout","$window","Settings","Storage","Recent","Bookmarks","Config"],angular.module("app.panels").controller("RightSettingsCtrl",e)}(),function(){"use strict";function e(e,t,s,n,r,o,a,i,c,l,u,d,p,f){function h(){w.deckId="deck.id"===r.current.name?r.params.id:null,r.current.pinCard||o("right-card").close()}function g(e,t,s){o("right-card").close().then(function(){$(e,t,s),r.go("cards")})}function m(){w.c&&(w.decks=S,w.related=v)}function y(e){o("right-card").close().then(function(){r.go("deck.id",{id:e.id})})}function k(e,t){C(t)}function C(e){t(function(){p.card=e,w.c=e,S=_.values(e.s.decks),w.decks=_.take(S,15),v=ScrollsTypes.RelatedCards(e,i,20),w.related=_.take(v,15),n[0].activeElement&&n[0].activeElement.blur();var r=o("right-card");r.isOpen()?s.setTimeout(function(){n[0].getElementById("right-card-content").scrollTop=0,t(function(){l.add(e.s.id)},333.333)}):s.setTimeout(function(){r.open().then(function(){s.setTimeout(function(){n[0].getElementById("right-card-content").scrollTop=0,t(function(){l.add(e.s.id)},333.333)})})},83.333)}),a.eventTrack(e.s.name,{category:"Card"})}var v,S,w=this,$=d.setFilter(u);w.settingsCopy=angular.copy(f.settingsCard),w.filter=u,w.look=c.look,w.set=c.set,w.showCard=C,w.deckPaging=m,w.openDeck=y,w.setFilter=g,w.filterParams=d.filterParams,e.$on("showCard",k),e.$on("$stateChangeSuccess",h)}e.$inject=["$rootScope","$timeout","$window","$document","$state","$mdSidenav","$analytics","Scrolls","Bookmarks","Recent","FilterCards","FilterUtils","Status","Config"],angular.module("app.panels").controller("RightCardCtrl",e)}(),function(){"use strict";angular.module("app",["app.core","app.services","app.directives","app.controllers","app.data","app.layout","app.panels"])}(),function(){"use strict";function e(e){e.state("help",{url:"/help",views:{body:{templateUrl:"app/pages/help/help.html",controller:"HelpCtrl",controllerAs:"vm",resolve:{Scrolls:["Scrolls",function(e){return e.promise}]}},side:{templateUrl:"app/pages/help/help-left.html"},bar:{templateUrl:"app/layout/bar.html"}}}).state("help.section",{url:"/:section"})}e.$inject=["$stateProvider"],angular.module("app").config(e)}(),function(){"use strict";function e(e,t,s,n,r,o,a,i,c){function l(){var e=n.params.section;if(e){var s=t[0].getElementById(e);s&&(t[0].getElementById("page-content").scrollTop=s.offsetTop-16)}}function u(){s(l,250)}function d(){s(l)}var p=this;o.setTitle("Help"),p.config=i,p.scrolls=r,p.bm=a.bookmarklet(i.currentInstance),c.fab=null,e.$on("$locationChangeSuccess",u),e.$on("$viewContentLoaded",d),s(function(){var e=t[0].getElementById("page-content");e.focus()})}e.$inject=["$scope","$document","$timeout","$state","Scrolls","UtilsUi","Utils","Config","Status"],angular.module("app").controller("HelpCtrl",e)}(),function(){"use strict";function e(e){e.state("decks",{url:"/decks",views:{body:{templateUrl:"app/pages/decks/decks.html",controller:"DecksCtrl",controllerAs:"decksCtrl",resolve:{Decks:["Decks",function(e){return e.promise}]}},side:{templateUrl:"app/pages/decks/decks-left.html",controller:"LeftDecksCtrl",controllerAs:"leftCtrl"},bar:{templateUrl:"app/layout/bar.html"}},params:{search:null},scroll:!0})}e.$inject=["$stateProvider"],angular.module("app").config(e)}(),function(){"use strict";function e(e,t,s,n,r,o,a,i,c,l,u,d,p){function f(){var e=ScrollsTypes.AddDeck({deck:"New Deck"},!1,!1,!1,i.decks.length);i.decks.push(new ScrollsTypes.DeckExtended(ScrollsTypes._decks[e])),n.go("deck.new",{id:e})}function h(){v.destroyed=!0,a.fab=null}function g(e){n.go("deck.id",{id:e.id})}function m(){v.limit=35,C.lazy=[]}function y(e){if(!v.destroyed&&o[0]&&(!angular.isUndefined(e)||C.lazy.length)&&(C.selectedIndex===S&&c.sorted?c.sorted=d.sort(c.params.sort,c.sorted):w?(c.sorted=d.sort(w,o[C.selectedIndex]),c.sorted=d.sort(c.params.sort,c.sorted)):c.sorted=d.sort(c.params.sort,o[C.selectedIndex]),c.items=d.filter(c.sorted,c.params,c.text),S=C.selectedIndex,w=c.params.sort,v.si=e||C.selectedIndex,c.stats=o.stats[C.selectedIndex],u.setNext(C,v,c))){var t=u.getPagingIteration(C,c,v,r);v.running||t()}}function k(e,t){(""!==e&&null!==e||t)&&(m(),C.paging(C.selectedIndex))}var C=this,v={running:!1,destroyed:!1},S=0,w=null;C.selectedIndex=0,C.selectedIndexCopy=0,C.selectedIndexChanged=p.getTabDelay(C,k),C.paging=y,C.settingsCopy=l.settingsCopy,C.openDeck=g,C.addDeck=f,C.filter=c,C.myScrolls=i.cards,c.items=null,c.sorted=null,p.setTitle("Decks"),e.$on("$destroy",h),t(function(){a.fab={"class":"mdi-plus",click:f}},400),t(function(){var e=s[0].getElementById("page-content");e.focus()}),e.$watch(function(){return i.decks},k),e.$watch(function(){return c.params},k,!0),e.$watch(function(){return c.text.search},k),c.text.search=n.params.search}e.$inject=["$scope","$timeout","$document","$state","quickRepeatList","Decks","Status","Storage","FilterDecks","Settings","UtilsPaging","UtilsDecks","UtilsUi"],angular.module("app").controller("DecksCtrl",e)}(),function(){"use strict";function e(e){var t=this;t.filter=e}e.$inject=["FilterDecks"],angular.module("app").controller("LeftDecksCtrl",e)}(),function(){"use strict";function e(e){e.state("deck",{url:"/deck","abstract":!0,views:{body:{templateUrl:"app/pages/deck/deck.html",controller:"DeckCtrl",controllerAs:"cardsCtrl",resolve:{Decks:["Decks",function(e){return e.promise}],Cards:["Cards",function(e){return e.promise}]}},side:{templateUrl:"app/pages/deck/deck-left.html",controller:"LeftDeckCtrl",controllerAs:"ct",resolve:{Scrolls:["Scrolls",function(e){return e.promise}],Cards:["Cards",function(e){return e.promise}]}},bar:{templateUrl:"app/layout/bar.html"}},scroll:!0,pinCard:!0}).state("deck.import",{url:"?types&deck&author&origin&version",params:{types:null,deck:null,author:null,origin:null,version:null},scroll:!0,pinCard:!0}).state("deck.id",{url:"/:id",scroll:!0,pinCard:!0}).state("deck.new",{url:"/:id",scroll:!0,pinCard:!0})}e.$inject=["$stateProvider"],angular.module("app").config(e)}(),function(){"use strict";function e(e,t,s,n,r,o,a,i,c,l,u,d,p,f){function h(e){e.target.select()}function g(){ScrollsTypes.RemoveDeck(F.deck),f.decks.splice(f.decks.indexOf(F.deck.storageId),1),o.go("decks")}function m(){}function y(){F.cloning||(F.cloning=!0,s(function(){var e=ScrollsTypes.AddDeck(F.deck,!1,!1,!0,f.decks.length);ScrollsTypes.CountScrollsDecks(),ScrollsTypes.GetDecksStats(),F.selectedIndex=0,F.selectedIndexCopy=0,f.decks.push(new ScrollsTypes.DeckExtended(ScrollsTypes._decks[e])),o.go("deck.id",{id:e})},0))}function k(){var e=a.confirm().theme(u.settings.dark?"dark":"default").title("Import deck").content("Duplicated deck import detected, do you want to open existing or import anyway?").cancel("Open").ok("Import");return delete e._options.template,e._options.templateUrl="app/shared/views/dialog.html",e._options.clickOutsideToClose=!0,e._options.ariaLabel=e._options.title,a.show(e)}function C(e){var t=ScrollsTypes.AddDeck(e,!1,!1,!1,f.decks.length);ScrollsTypes.CountScrollsDecks(),ScrollsTypes.GetDecksStats(),f.decks.push(new ScrollsTypes.DeckExtended(ScrollsTypes._decks[t])),o.go("deck.id",{id:t})}function v(){if(F.cloning=!1,o.params.types){var e=new ScrollsTypes.DeckExtended(o.params),t=ScrollsTypes.GetDeckByHash(e.getDeckHash());t?k().then(function(){C()},function(){o.go("deck.id",{id:t.id})}):C(e)}else o.params.id&&c.getDeck(o.params.id,function(e){e&&(F.deck=e,F.deck.deck&&p.setTitle("Deck:",F.deck.deck),I(),B(),q.resolve(),L())});s(function(){var e=r[0].getElementById("page-content");e.focus()})}function S(){w(),x()}function w(){p.setTitle("Deck:",F.filter.deck.deck||"?")}function $(){try{var e=angular.fromJson(F.filter.json);F.filter.error.invalidJson=!1;var t=new ScrollsTypes.DeckExtended(e);z.replaceDeck(t),w(),l.stats=z.cards[0].s}catch(s){F.filter.error.invalidJson=!0}}function T(){x()}function D(){x()}function x(){I(),A()}function b(e){o.go("decks",{search:e})}function I(){F.filter.deck=F.deck,F.params=F.deck.toDeckSimple(),F.filter.json=angular.toJson(F.params),F.params.origin=F.deck.origin,F.params.types=F.params.types.join(",");var e=angular.element("<a>")[0];e.href=n.location.href,e.hash=o.href("deck.import",F.params).replace(/%2C/g,","),F.share=e.href}function R(){O.destroyed=!0}function A(){F.deck.storageId&&(F.deck.storageId=f.decks[f.decks.indexOf(F.deck.storageId)]=new ScrollsTypes.DeckExtended(F.deck))}function P(e,t,n){e.stopPropagation&&e.stopPropagation();var r=z.addType(t);r&&(A(),n||(n=_.find(F.lazy,function(e){return e.s.id===t})),n?n.c++:(l.items=l.sorted=z.cards[F.selectedIndex].c,F.lazy=_.take(F.filter.items,F.lazy.length+1),s(function(){i.items(F.lazy)},0)),l.stats=z.cards[F.selectedIndex].s)}function U(e,t,n){e.stopPropagation(),z.removeType(t),n.c--,A(),0===n.c&&(l.items=l.sorted=z.cards[F.selectedIndex].c,F.lazy=_.take(F.filter.items,F.lazy.length-1),s(function(){i.items(F.lazy)},0)),l.stats=z.cards[F.selectedIndex].s}function E(){O.limit=35,F.lazy=[],l.lazy=F.lazy}function j(e){if(!O.destroyed&&z&&z.cards&&z.cards[0]&&(!angular.isUndefined(e)||F.lazy.length)&&(l.items=l.sorted=z.cards[F.selectedIndex].c,O.si=e||F.selectedIndex,l.stats=z.cards[F.selectedIndex].s,d.setNext(F,O,l))){var t=d.getPagingIteration(F,l,O,i);O.running||t()}}function L(){return I(),F.selectedIndex>2?(E(),void q.promise.then(function(){l.stats=z.cards[0].s})):void q.promise.then(function(){E(),l.stats=z.cards[F.selectedIndex].s,F.paging(F.selectedIndex)})}function B(){l.deckCards=z=new ScrollsTypes.DeckCards(F.deck)}var z,F=this,O={destroyed:!1,running:!1},q=t.defer();F.settingsCopy=u.settingsCopy,F.paging=j,F.showCard=p.showCard,F.minus=U,F.plus=P,F.selectedIndex="deck.new"===o.current.name?3:0,F.selectedIndexCopy="deck.new"===o.current.name?3:0,F.selectedIndexChanged=p.getTabDelay(F,L),F.filter=l,F.search=b,F.deleteDeck=g,F.resetDeck=m,F.cloneDeck=y,F.selectAll=h,F.focusData="deck.new"===o.current.name,F.inputDeckChanged=S,F.inputDataChanged=$,F.inputAuthorChanged=T,F.inputOriginChanged=D,F.filter.error={invalidJson:!1},p.setTitle("Deck"),l.sorted=null,l.edit=!1,e.$on("$destroy",R),e.$on("$stateChangeSuccess",v),e.$on("addType",P)}e.$inject=["$scope","$q","$timeout","$window","$document","$state","$mdDialog","quickRepeatList","Decks","FilterDeck","Settings","UtilsPaging","UtilsUi","Storage"],angular.module("app").controller("DeckCtrl",e)}(),function(){"use strict";function e(e,t,s,n,r,o,a,i,c,l,u){function d(t){e.$broadcast("addType",t.s.id)}function p(){v.selectedIndex=1,u.fab=null}function f(){T&&t(function(){1!==v.selectedIndex?u.fab={"class":"mdi-pencil",click:p}:u.fab=null}),T=!0,$()}function h(e,t,n){w(e,t,n),s.go("cards")}function g(e,t){e!==t&&k()}function m(e,t){e!==t&&k()}function y(){function e(){v.related&&8>s&&v.related.length<C.length?(S=!0,t(function(){v.related.push(C[v.related.length]),s++,e()},20)):S=!1}var s=0;1!==v.selectedIndexCopy||S||e()}function k(){v.filter.edit=1===v.selectedIndex,C=l.filter(r[0].c,o.params,o.text,n),v.related=_.take(C,15)}var C,v=this,S=!1,w=i.setFilter(a),$=c.getTabDelay(v,k),T=!1;v.filter=o,v.showResource=!0,v.edit=!0,v.status=u,v.showCard=c.showCard,v.selectedIndex=0,v.selectedIndexCopy=0,v.selectedIndexChanged=f,v.deckPaging=y,v.setFilter=h,v.addCard=d,v.filterParams=i.filterParams,o.querySearch=i.query(o,r[0].c,r[0].s),e.$watch(function(){return o.params},m,!0),e.$watch(function(){return o.text.search},g),"deck.new"===s.current.name?(v.selectedIndex=1,v.selectedIndexCopy=1,k()):t(function(){u.fab={"class":"mdi-pencil",click:p}},400)}e.$inject=["$rootScope","$timeout","$state","Bookmarks","Cards","FilterDeck","FilterCards","FilterUtils","UtilsUi","UtilsCards","Status"],angular.module("app").controller("LeftDeckCtrl",e)}(),function(){"use strict";function e(e,t){t.otherwise("/scrolls"),e.state("cards",{url:"/scrolls",views:{body:{templateUrl:"app/pages/cards/cards.html",controller:"CardsCtrl",controllerAs:"cardsCtrl",resolve:{CardsDecks:["CardsDecks",function(e){return e.promise}]}},side:{templateUrl:"app/pages/cards/cards-left.html",controller:"LeftCardsCtrl",controllerAs:"ct"},bar:{templateUrl:"app/layout/bar.html"}},scroll:!0,pinCard:!0}).state("cards.filter",{url:"?resources&costs&star&search&kind&type&rarity&trait&set",scroll:!0,pinCard:!0}).state("cards.import",{url:"?types",scroll:!0,pinCard:!0})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("app").config(e)}(),function(){"use strict";function e(e,t,s,n,r,o,a,i,c,l,u,d,p,f,h,g,m){function y(){t(function(){R.selectedIndex>0&&R.selectedIndex<3?p.fab={"class":"mdi-pencil",click:R.showProperties}:p.fab=null}),E()}function k(){R.filter=u,R.selectedIndex=0,R.selectedIndexCopy=0,R.selectedIndexChanged=y,R.paging=b,R.settingsCopy=f.settingsCopy,R.showCard=h.showCard,R.showProperties=$,R.setAllCards=w,R.resetCards=S,R.cardsParams={types:""},R.input={cards:angular.toJson(d.cards)},R.inputCards=v,h.setTitle("Scrolls"),u.items=null,u.sorted=null,v(!0);var e=s.search();if(e.types){var r=e.types.split(",");angular.forEach(r,function(e,t){r[t]=parseInt(e)}),C().then(function(){R.input.cards=angular.toJson({types:r})})}t(function(){var e=n[0].getElementById("page-content");e.focus()})}function C(){var e=r.confirm().theme(f.settings.dark?"dark":"default").title("Import scrolls collection").content("A scrolls collection has been shared with you, do you want to import?<br />Your current <em>My scrolls</em>  collection will be replaced.").cancel("Cancel").ok("Import");return delete e._options.template,e._options.templateUrl="app/shared/views/dialog.html",e._options.clickOutsideToClose=!0,e._options.ariaLabel=e._options.title,r.show(e)}function v(e){if(R.input.cards)try{var t=angular.fromJson(R.input.cards);e||d.set("cards",t),R.cardsParams.types=t.types.join(",")}catch(s){}}function S(){R.input.cards=angular.toJson({types:[]}),v()}function w(){l.promise.then(function(){var e=[];angular.forEach(l.parsed,function(t){e.push(t.id),e.push(t.id),e.push(t.id)}),R.input.cards=angular.toJson({types:e}),v()})}function $(){R.selectedIndex=3}function _(e,t){e!==t&&(I(),o.eventTrack("Cards",{category:"Search"}))}function T(e,t){e!==t&&(I(),o.eventTrack("Cards",{category:"Filter"}))}function D(){A.destroyed=!0}function x(){A.limit=35,R.lazy=[]}function b(e){if(!A.destroyed&&i.Cards[0]&&(!angular.isUndefined(e)||R.lazy.length)){if(R.selectedIndex>2)return void(P=R.selectedIndex);if(R.selectedIndex===P&&u.sorted?u.sorted=g.sort(u.params.sort,u.sorted):U?(u.sorted=g.sort(U,i.Cards[R.selectedIndex].c),u.sorted=g.sort(u.params.sort,u.sorted)):u.sorted=g.sort(u.params.sort,i.Cards[R.selectedIndex].c),u.items=g.filter(u.sorted,u.params,u.text,c),P=R.selectedIndex,U=u.params.sort,A.si=e||R.selectedIndex,u.stats=i.Cards[R.selectedIndex].s,!(R.lazy.length<A.limit-5&&R.lazy.length)){A.limit+=25,A.limit=A.limit>u.items.length?u.items.length:A.limit;var t=m.getPagingIteration(R,u,A,a);A.running||t()}}}function I(){x(),R.paging(R.selectedIndex),R.selectedIndex<3&&u.items.length!==u.sorted.length?h.setTitle("Scrolls:",u.items.length+" of "+u.sorted.length):h.setTitle("Scrolls")}var R=this,A={destroyed:!1,running:!1},P=0,U=null,E=h.getTabDelay(R,I);k(),p.fab=null,e.$on("$destroy",D),i.Cards.promise.then(I),e.$watch(function(){return d.cards},I),e.$watch(function(){return u.params},T,!0),e.$watch(function(){return u.text.search},_)}e.$inject=["$scope","$timeout","$location","$document","$mdDialog","$analytics","quickRepeatList","CardsDecks","Bookmarks","Scrolls","FilterCards","Storage","Status","Settings","UtilsUi","UtilsCards","UtilsPaging"],angular.module("app").controller("CardsCtrl",e)}(),function(){"use strict";function e(e,t,s,n,r,o){function a(){r.disabled=!0;var e=t.search();delete e.types,o.fromParams(e,r),n("right-card").close().then(function(){s(function(){s(function(){r.disabled=!1})})})}function i(e,t,s){l(e,t,s)}var c=this,l=o.setFilter(r);c.filter=r,c.setFilter=i,c.filterParams=o.filterParams,e.$on("$stateChangeSuccess",a)}e.$inject=["$scope","$location","$timeout","$mdSidenav","FilterCards","FilterUtils"],angular.module("app").controller("LeftCardsCtrl",e)}(),function(){"use strict";function e(e){e.state("card",{url:"/scroll",views:{body:{templateUrl:"app/pages/card/card.html",controller:"CardCtrl",controllerAs:"ct",resolve:{ScrollsDecks:["ScrollsDecks",function(e){return e.promise}],Cards:["Cards",function(e){return e.promise}]}},side:{templateUrl:"app/pages/card/card-left.html"},bar:{templateUrl:"app/pages/card/card-bar.html",controller:"LeftCardBookmarksCtrl",controllerAs:"barCtrl"}}}).state("card.id",{url:"/:id"})}e.$inject=["$stateProvider"],angular.module("app").config(e)}(),function(){"use strict";function e(e,t,s,n,r,o,a,i,c,l,u,d,p){function f(e,t,s){C(e,t,s),n.go("cards")}function h(e,t){k.showCard(t)}function g(e){n.go("deck.id",{id:e.id})}function m(e){n.go("card.id",{id:e.s.id}),t(function(){u.add(e.s.id)},50)}function y(){if(n.params.id){var e=o.Scrolls.look[n.params.id];e&&(k.c=d.card={s:e},k.decks=_.values(e.decks),k.related=ScrollsTypes.RelatedCards(new ScrollsTypes.Card(e),a),c.setTitle("Scroll:","#"+n.params.id),t(function(){var t=s[0].getElementById("page-content");t.scrollTop=0,t.focus(),u.add(e.id)}))}}var k=this,C=i.setFilter(l);k.settingsCopy=angular.copy(p.settingsCardFull),k.filter=l,k.showCard=m,k.openDeck=g,k.setFilter=f,k.filterParams=i.filterParams,d.fab=null,e.$on("openCard",h),e.$on("$stateChangeSuccess",y),r("right-card").close(),c.setTitle("Scroll"),y()}e.$inject=["$rootScope","$timeout","$document","$state","$mdSidenav","ScrollsDecks","Scrolls","FilterUtils","UtilsUi","FilterCards","Recent","Status","Config"],angular.module("app").controller("CardCtrl",e)}(),function(){"use strict";function e(e,t,s){function n(t){e.$emit("openCard",t)}var r=this;r.related=t.scrolls,r.showResource=!0,r.showCard=n,r.status=s}e.$inject=["$rootScope","Recent","Status"],angular.module("app").controller("LeftCardRecentCtrl",e)}(),function(){"use strict";function e(e,t,s){function n(t){e.$emit("openCard",t)}var r=this;r.related=t.scrolls,r.look=t.look,r.set=t.set,r.status=s,r.showResource=!0,r.showCard=n}e.$inject=["$rootScope","Bookmarks","Status"],angular.module("app").controller("LeftCardBookmarksCtrl",e)}(),function(){"use strict";function e(e,t,s,n,r,o,a,i,c){function l(e){var s=r.alert().theme(c.settings.dark?"dark":"default").title("Import scrolls collection").ok("Ok");return delete s._options.template,s._options.templateUrl="app/shared/views/filter-search-help.html",s._options.parent=angular.element(t.body),s._options.targetEvent=e,s._options.clickOutsideToClose=!0,r.show(s)}function u(){n("right-settings").close(),n("right-card").close()}function d(){n("left").open()}function p(){n("left").close()}function f(e){s.show({templateUrl:"app/layout/bottom.html",targetEvent:e}).then(function(e){o.go(e)})}function h(t){n("right-settings").toggle().then(function(){angular.isDefined(t)&&e.$emit("settingsTab",t)}),a.eventTrack("Settings",{category:"Commands"})}function g(){n("right-settings").close()}function m(){n("right-card").close()}function y(){n("left").toggle()}var k=this;k.state=o,k.openBottom=f,k.openRight=h,k.closeRight=g,k.closeRightCard=m,k.toggleLeft=y,k.status=i,k.mainSwipeRight=d,k.mainSwipeLeft=p,k.leftSwipeLeft=p,k.rightSwipeRight=u,k.settingsCopy=c.settingsCopy,k.filterHelp=l,k.pinCard=!1}e.$inject=["$rootScope","$document","$mdBottomSheet","$mdSidenav","$mdDialog","$state","$analytics","Status","Settings"],angular.module("app").controller("ToolbarCtrl",e)}(),function(){"use strict";function e(e){var t=this;t.itemClick=function(t){e.hide(t)}}e.$inject=["$mdBottomSheet"],angular.module("app").controller("BottomCtrl",e)}(),function(){"use strict";angular.module("app.layout",["app.core"])}(),function(){"use strict";angular.module("app.filters",[])}(),function(){"use strict";function e(e,t){function s(e){return function(t,s){var n=e.params[t];s&&(s.ctrlKey||s.altKey)&&(e.params.g=n,e.params.e=n,e.params.o=n,e.params.d=n),e.params[t]=!n}}function n(e){return function(t,s){var n=e.params[t];s&&(s.ctrlKey||s.altKey)&&(e.params[1]=n,e.params[2]=n,e.params[3]=n,e.params[4]=n,e.params[5]=n,e.params[6]=n,e.params[7]=n,e.params[8]=n),e.params[t]=!n}}function r(e,t,s){var n=angular.copy(d),r=c(n);return r(e,t,s),a(n)}function o(e,t){angular.forEach(e,function(t,s){e[s]=decodeURIComponent(decodeURIComponent(t))});var s="none"===e.resources?"":e.resources?e.resources:l,n="none"===e.costs?"":e.costs?e.costs:u;angular.forEach(l,function(e){t.params[e]=_.indexOf(s,e)>-1}),angular.forEach(u,function(e){t.params[e]=_.indexOf(n,e)>-1}),t.params.star=e.star||0,
t.text.search=e.search||"",t.params.selectedItem=null,e.search||angular.forEach(e,function(e,s){"resources"!==s&&"costs"!==s&&"star"!==s&&"search"!==s&&e&&(t.params.selectedItem={},t.params.selectedItem.name="set"===s?"Set "+e:e,t.params.selectedItem[s]="set"===s?parseInt(e):!0,t.text.search=t.params.selectedItem.name)})}function a(e){var t=0,s=0,n={resources:null,costs:null,star:null,search:null,kind:null,type:null,trait:null,rarity:null,set:null};return angular.forEach(l,function(s){t+=e.params[s]}),angular.forEach(u,function(t){s+=e.params[t]}),0===t?n.resources="none":4>t&&(n.resources="",angular.forEach(l,function(t){n.resources+=e.params[t]?t:""})),0===s?n.costs="none":8>s&&(n.costs="",angular.forEach(u,function(t){n.costs+=e.params[t]?t:""})),e.params.star&&(n.star=e.params.star),e.params.selectedItem?(angular.forEach(e.params.selectedItem,function(t,s){t===!0&&(n[s]=e.params.selectedItem.name)}),n.set=e.params.selectedItem.set||null):e.text.search&&(n.search=e.text.search),n}function i(s,n,r){return function(o){if(!o||s.disabled)return[];if(s.params.selectedItem&&s.params.selectedItem.name===o)return[s.params.selectedItem];n=n||s.sorted,r=r||s.stats,o=o.toLowerCase();var a=t.defer();return e(function(){var e=[],t=[],s=["CREATURE","ENCHANTMENT","SPELL","STRUCTURE"],i=["Common","Uncommon","Rare"],c=[],l=[],u=[],d=[],p=[],f={};_.each(s,function(e){var t=e.toLowerCase().indexOf(o);0===t&&c.push({name:e,kind:!0})}),_.each(i,function(e){var t=e.toLowerCase().indexOf(o);0===t&&c.push({name:e,rarity:!0})}),r&&r.type&&_.each(r.type.total,function(e){var t=e[0].toLowerCase().indexOf(o);0===t&&l.push({name:e[0],type:!0})}),r&&r.trait&&_.each(r.trait.total,function(e){var t=e[0].toLowerCase().indexOf(o);0===t&&u.push({name:e[0],trait:!0})}),_.each(n,function(s){var n=s.s.nameLowerCase.indexOf(o);f[s.s.set]=!0,-1!==n&&(0===n?e.push({name:s.s.name,card:s}):t.push({name:s.s.name,card:s}))}),_.each(f,function(e,t){var s="Set "+t,n=s.toLowerCase().indexOf(o);n>-1&&p.push({name:s,set:parseInt(t)})}),e=_.sortBy(e,"name"),t=_.take(_.sortBy(t,"name"),t.length<25?t.length:25);var h=p.concat(c).concat(d).concat(l).concat(u).concat(e).concat(t);a.resolve(h)}),a.promise}}function c(e){return function(t,s,n){var r=0;if(s=_.isNumber(s)&&0!==s?s.toString():s,"cost"===t)r=s,e.params.selectedItem=null,e.text.search=null;else if("?"===t)e.text.search=s||"";else{var o={name:s};t&&(o[t]=!0,e.params.selectedItem=o),e.text.search=s||"","set"===t&&s&&(e.text.search=o.name="Set "+s,o[t]=parseInt(s))}for(var a=1;8>=a;a++)e.params[a]=!r||r===a.toString();n=n||"total",e.params.g="r0"===n||"total"===n,e.params.e="r1"===n||"total"===n,e.params.o="r2"===n||"total"===n,e.params.d="r3"===n||"total"===n,angular.isUndefined(t)&&(e.params.star=0)}}var l="geod",u="12345678",d={text:{},params:{}};return{toParams:a,fromParams:o,query:i,setFilter:c,filterParams:r,setResource:s,setCost:n,resources:{g:!0,e:!0,o:!0,d:!0},costs:{1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},dummy:d}}e.$inject=["$timeout","$q"],angular.module("app.filters").factory("FilterUtils",e)}(),function(){"use strict";function e(e){var t={};return t.text={search:""},t.params=angular.extend({sort:"name",selectedItem:null},e.resources),t.querySearch=function(){return[]},t.setResource=e.setResource(t),t}e.$inject=["FilterUtils"],angular.module("app.filters").factory("FilterDecks",e)}(),function(){"use strict";function e(e){var t={};return t.text={search:""},t.params=angular.extend({star:0,selectedItem:null},e.resources,e.costs),t.setResource=e.setResource(t),t.setCost=e.setCost(t),t}e.$inject=["FilterUtils"],angular.module("app.filters").factory("FilterDeck",e)}(),function(){"use strict";function e(e){var t={};return t.text={search:""},t.params=angular.extend({star:0,sort:"cost",selectedItem:null},e.resources,e.costs),t.querySearch=e.query(t),t.setResource=e.setResource(t),t.setCost=e.setCost(t),t}e.$inject=["FilterUtils"],angular.module("app.filters").factory("FilterCards",e)}(),function(){"use strict";angular.module("app.data",["ngResource","app.services"])}(),function(){"use strict";function e(e,t,s){var n=e.defer();return e.all([t.$promise,s.promise]).then(function(e){ScrollsTypes._scrolls=new ScrollsTypes.Scrolls(e[0],s.webp),angular.extend(n,ScrollsTypes._scrolls),n.resolve(n)}),n}e.$inject=["$q","ScrollsResource","WebP"],angular.module("app.data").factory("Scrolls",e)}(),function(){"use strict";function e(e){return e("./data/scrolls-42ea5b70.json").get()}e.$inject=["$resource"],angular.module("app.data").factory("ScrollsResource",e)}(),function(){"use strict";function e(e,t,s){var n=e.defer(),r=8;return n.types=t.recent,n.scrolls=[],s.promise.then(function(){angular.forEach(n.types,function(e){n.scrolls.push({s:s.look[e]})}),n.resolve(n)}),n.add=function(e){n.promise.then(function(){var t=n.types.indexOf(e);if(t>=0&&(n.types.splice(t,1),n.scrolls.splice(t,1)),(t>=0||-1===t)&&(n.types.unshift(e),n.scrolls.unshift({s:s.look[e]})),n.types.length>r){var o=n.types.length-r;n.types.splice(r,o),n.scrolls.splice(r,o)}})},n.reset=function(){n.types.splice(0,n.types.length),n.scrolls.splice(0,n.scrolls.length)},n}e.$inject=["$q","Storage","Scrolls"],angular.module("app.data").factory("Recent",e)}(),function(){"use strict";function e(e,t,s,n,r,o){function a(){t.$watch(function(){return o[1].c},function(){angular.extend(l,ScrollsTypes._decksCategorized),l.decks=ScrollsTypes._decks,ScrollsTypes.ResetDecks(),ScrollsTypes.AddDecks(n.starters,!0,!0),ScrollsTypes.AddDecks(n.preconstructed,!0,!0),ScrollsTypes.AddDecks(n.users,!0),ScrollsTypes.AddDecks(n.test),ScrollsTypes.AddStoredDecks(s.decks),ScrollsTypes.CountScrollsDecks(),l.stats=ScrollsTypes.GetDecksStats(),l.resolve(l)})}function i(e,t){l.promise.then(function(){t(l.decks[e])})}function c(e){ScrollsTypes.RemoveDeck(e),l.stats=ScrollsTypes.GetDecksStats()}var l=e.defer();return l.getDeck=i,l.removeDeck=c,e.all([r.promise,o.promise,n.$promise]).then(a),l}e.$inject=["$q","$rootScope","Storage","DecksResource","Scrolls","Cards"],angular.module("app.data").factory("Decks",e)}(),function(){"use strict";function e(){function e(e){return{types:e.types.join(","),deck:e.deck,author:e.author,origin:e.origin}}return{deckParams:e}}angular.module("app.data").factory("DecksUtils",e)}(),function(){"use strict";function e(e){return e("./data/decks-f4c2e6af.json").get()}e.$inject=["$resource"],angular.module("app.data").factory("DecksResource",e)}(),function(){"use strict";function e(e,t,s){return s.getComboPromise({Decks:t,Scrolls:e})}function t(e,t,s){return s.getComboPromise({Cards:e,Decks:t})}e.$inject=["Scrolls","Decks","Utils"],t.$inject=["Cards","Decks","Utils"],angular.module("app.data").factory("CardsDecks",t),angular.module("app.data").factory("ScrollsDecks",e)}(),function(){"use strict";function e(e,t,s,n){var r=e.defer();return n.promise.then(function(){t.$watch(function(){return s.cards},function(){var e=s.cards&&s.cards.types;ScrollsTypes._cardsReport=new ScrollsTypes.CardsReport(e,n),angular.extend(r,ScrollsTypes._cardsReport),ScrollsTypes._typesCounts=new ScrollsTypes.TypesCounts(ScrollsTypes._cardsReport[1].c),r.resolve(r)})}),r}e.$inject=["$q","$rootScope","Storage","Scrolls"],angular.module("app.data").factory("Cards",e)}(),function(){"use strict";function e(e,t,s){var n=e.defer();return n.types=t.bookmarks,n.scrolls=[],n.look={},s.promise.then(function(){angular.forEach(n.types,function(e){n.scrolls.push({s:s.look[e]}),n.look[e]=!0}),n.resolve(n)}),n.set=function(e){n.promise.then(function(){if(n.look[e]){n.look[e]=!1;var t=n.types.indexOf(e);n.types.splice(t,1),n.scrolls.splice(t,1)}else n.look[e]=!0,n.types.unshift(e),n.scrolls.unshift({s:s.look[e]})})},n.reset=function(){n.types.splice(0,n.types.length),n.scrolls.splice(0,n.scrolls.length),angular.copy({},n.look)},n}e.$inject=["$q","Storage","Scrolls"],angular.module("app.data").factory("Bookmarks",e)}(),function(){"use strict";angular.module("app.core",["ngAnimate","ngSanitize","ngMessages","ui.router","ngMaterial","infinite-scroll","QuickList","angulartics","angulartics.google.analytics"])}(),function(){"use strict";function e(e){var t=!0;t?(e.definePalette("alt",e.extendPalette("blue-grey",{A100:"DFE7EB"})),e.definePalette("bg",e.extendPalette("blue-grey",{})),e.theme("default").backgroundPalette("alt").warnPalette("blue-grey").primaryPalette("bg").accentPalette("blue-grey",{"default":"600"})):(e.definePalette("light-bg",e.extendPalette("brown",{A100:"E8E8E8"})),e.definePalette("light-primary",e.extendPalette("brown",{500:"7A746C"})),e.definePalette("light-accent",e.extendPalette("brown",{500:"7A746C"})),e.theme("default").backgroundPalette("light-bg").warnPalette("brown").primaryPalette("light-primary").accentPalette("light-accent",{"default":"500"})),e.definePalette("alt-dark",e.extendPalette("grey",{800:"494744"})),e.definePalette("accent",e.extendPalette("amber",{500:"E0AA07"})),e.definePalette("alt-amber",e.extendPalette("amber",{500:"E0AA07"})),e.theme("dark").backgroundPalette("alt-dark").primaryPalette("alt-amber").accentPalette("accent").dark(),e.alwaysWatchTheme(!0)}e.$inject=["$mdThemingProvider"],angular.module("app.core").config(e)}(),function(){"use strict";function e(e){function t(e,t,s){function n(n,r){e(n,r),s.error(n,r),t.eventTrack(n.stack,{category:"Exception"})}return n}t.$inject=["$delegate","$analytics","$log"],e.decorator("$exceptionHandler",t)}e.$inject=["$provide"],angular.module("app").config(e)}(),function(){"use strict";function e(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}e.$inject=["$compileProvider"],angular.module("app").config(e)}();var ScrollsTypes;!function(e){"use strict";var t=function(){function t(t,s,n){void 0===s&&(s=!1),void 0===n&&(n=!1);var r=new e.ResCountTotal,o=new e.ResCount,a=new e.ResCount,i=new e.ResCount,c=new e.ResCount,l=new e.ResCount,u=new e.ResCount,d=new e.ResCount,p=new e.ResCount;t.forEach(function(e){var t=s?e.c:1;if(e.s){var n=e.s.growth?"g":e.s.energy?"e":e.s.order?"o":"d",f=e.s.growth+e.s.energy+e.s.order+e.s.decay;o[n][f]=(o[n][f]||0)+t,o.total[f]=(o.total[f]||0)+t,r[n]=(r[n]||0)+t,r.total=(r.total||0)+t,a[n][e.s.kind]=(a[n][e.s.kind]||0)+t,a.total[e.s.kind]=(a.total[e.s.kind]||0)+t,i[n][e.s.rarity]=(i[n][e.s.rarity]||0)+t,i.total[e.s.rarity]=(i.total[e.s.rarity]||0)+t,e.s.typesArr.forEach(function(e){e&&(c[n][e]=(c[n][e]||0)+t,c.total[e]=(c.total[e]||0)+t)}),e.s.traits.forEach(function(e){e&&(l[n][e]=(l[n][e]||0)+1,l.total[e]=(l.total[e]||0)+1)}),("CREATURE"===e.s.kind||"STRUCTURE"===e.s.kind)&&(u[n][e.s.ap]=(u[n][e.s.ap]||0)+1,u.total[e.s.ap]=(u.total[e.s.ap]||0)+1,d[n][e.s.ac]=(d[n][e.s.ac]||0)+1,d.total[e.s.ac]=(d.total[e.s.ac]||0)+1,p[n][e.s.hp]=(p[n][e.s.hp]||0)+1,p.total[e.s.hp]=(p.total[e.s.hp]||0)+1)}});for(var f=n?8:parseInt(_.max(_.keys(o.total),function(e){return parseInt(e,10)}),10),h=1;f>=h;h++)o.g[h]=o.g[h]||"",o.e[h]=o.e[h]||"",o.o[h]=o.o[h]||"",o.d[h]=o.d[h]||"",o.total[h.toString()]=o.total[h];this.max=_.max(o.total),this.resources=_.keys(r).length-1,this.count=new e.ResCountSorted(o),this.kind=new e.ResCountSorted(a),this.rarity=new e.ResCountSorted(i),this.type=new e.ResCountSorted(c),this.trait=new e.ResCountSorted(l),this.total=new e.ResCountSorted(r),this.attack=new e.ResCountSorted(u,!0),this.counter=new e.ResCountSorted(d,!0),this.health=new e.ResCountSorted(p,!0),e.toSortedArray(this.type),e.toSortedArray(this.trait)}return t}();e.Stats=t}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";var t=function(){function t(s,n){var r=this;void 0===n&&(n=!1),this.parsed=[],this.look={},this.kinds={},this.types={},this.modified=new Date(s.modified),this.version=s.version,t.initResources(this.kinds),t.initResources(this.types),s.types.forEach(function(t){var o=new e.Scroll(t,s,n);r.parsed.push(o),r.look[o.id]=o,r.kinds[o.r][o.kind]=r.kinds[o.r][o.kind]||[],r.kinds[o.r][o.kind].push(o),o.typesArr.forEach(function(e){r.types[o.r][e]=r.types[o.r][e]||[],r.types[o.r][e].push(o)})})}return t.initResources=function(t){t[e.Resource[0]]={},t[e.Resource[1]]={},t[e.Resource[2]]={},t[e.Resource[3]]={}},t}();e.Scrolls=t}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";function t(e,t){return void 0===t&&(t=!1),e&&e.replace(/\\n/g,"\n").trim().replace(/\.\.\./g,"&hellip;").replace(/(<[^>]+)\\n([^>]+>)/g,"$1 $2").replace(/\[([^\]]+)]/g,"<b>$1</b>").replace(/\.\n/g,".<br />").replace(/\n/g,t?" ":"<br />")}function s(e){return e&&e.replace(/"([^"]+)"/g,"&ldquo;$1&rdquo;").replace(/-/g,"&mdash;")}function n(e,t){return e&&e.replace(/<([^>]+)>/g,function(e,s){var n=s.replace(/\\n/g," "),r=_.find(t,function(e){return 0===n.indexOf(e.name)}).id;return'<a href="./#/scroll/'+r+'">'+n+"</a>"})}function r(e){return e&&e.replace(/<([^>]+)>/g,"<b>$1</b>")}function o(e){var t=/^[^:\d]+/,s=e[0].match(t),n=s[0].trim();return n[0].toUpperCase()+n.substr(1)}function a(e){for(var t={},s=/\[([^\]]+)]/g,n=s.exec(e);null!==n;)t[n[1].toLowerCase()]=!0,n=s.exec(e);return t}function i(e){if(!e.match)return e;var t=/^[^:\d]+/,s=e.match(t),n=_.trim(s[0]),r=n[0].toUpperCase()+n.substr(1).toLowerCase(),o=new RegExp("^"+n);return[n,r,e.replace(o,"")]}!function(e){e[e.g=0]="g",e[e.e=1]="e",e[e.o=2]="o",e[e.d=3]="d"}(e.Resource||(e.Resource={}));var c=e.Resource;!function(e){e[e.Common=0]="Common",e[e.Uncommon=1]="Uncommon",e[e.Rare=2]="Rare"}(e.Rarity||(e.Rarity={}));var l=e.Rarity,u=function(){function e(e,u,d){void 0===d&&(d=!1),this.decks={},this.decksCount=0;var p=e.types.split(",");p=p.length&&!p[0]?[]:p,e.img=e.img||"",this.id=e.id,this.name=e.name,this.nameLowerCase=e.name.toLowerCase(),this.flavor=s(t(e.flavor)),this.description=t(r(e.desc),!0),this.descriptionLink=t(n(e.desc,u.types),!0),this.rarity=e.rarity,this.rarityText=l[e.rarity],this.kind=e.kind,this.types=p.join(", "),this.typesArr=p,this.energy=e.energy,this.growth=e.growth,this.order=e.order,this.decay=e.decay,this.cost=e.growth+e.energy+e.order+e.decay,this.ri=e.growth?0:e.energy?1:e.order?2:3,this.r=c[this.ri],this.ap=e.ap,this.ac=e.ac,this.hp=e.hp,this.hp=e.hp,this.set=e.set,this.price=e.price||0,this.L="0px "+(-144*e.img-1)+"px",this.M="0px "+(-63*e.img-1)+"px",this.S="-10px "+(-48*e.img-1)+"px",this.Lc=(d?"app-art-webp-":"app-art-")+"l-"+this.r,this.Mc=(d?"app-art-webp-":"app-art-")+"m-"+this.r,this.Sc=(d?"app-art-webp-":"app-art-")+"s-"+this.r,this.bundle=e.bundle,this.traits=e.rules.map(o),this.rules=e.rules.map(function(e){return{name:t(e[0])}});var f=a(e.desc),h={};_.each(f,function(e,t){u.strings[t]&&(h[t]=u.strings[t])});var g=a(e.rules);_.each(g,function(e,t){u.strings[t]&&(h[t]=u.strings[t])}),_.each(e.rules,function(e){if(e&&(h[e[0].toLowerCase()]=e,e[0]=t(e[0]),e[1].indexOf("${AMOUNT}")>-1)){var s=/^[^\d]+(\d)/.exec(e[0]);e[1]=e[1].replace("${AMOUNT}",s&&s[1]||"amount")}}),this.terms=_.pairs(h),this.traits=_.uniq(this.traits.concat(_.map(this.terms,o))),_.each(this.terms,function(e){e[1][0]=i(e[1][0])}),this.p=0!==this.ap||0!==this.ac||0!==this.hp,this.ac=-1===this.ac?"—":this.ac}return e.prototype.updateDecksCount=function(){this.decksCount=_.keys(this.decks).length},e}();e.Scroll=u}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";function t(e){var t="total",s=e[t],n=[];_.each(s,function(e,t){n.push([t,e])}),n.sort(),e[t]=n}e.toSortedArray=t;var s=function(){function e(e,t){void 0===t&&(t=!1),this.r0=e.g,this.r1=e.e,this.r2=e.o,this.r3=e.d,this.total=e.total,t&&(this.getLimits(),this.fixRange())}return e.prototype.getLimits=function(){var e=0,t=0,s=1/0;_.each(this.total,function(n,r){var o=parseInt(r,10)||0;e=Math.max(e,o),t=Math.max(t,n),s=Math.min(s,o)}),this.max=t,this.min=s,this.range=e},e.prototype.fixRange=function(){var e=this;_.each(e,function(t){if(t&&_.isObject(t)){for(var s=e.total["—"]?1:e.min;s<=e.range;s++)t[s]=t[s]||"";e.total["—"]&&(t["—"]=t["—"]||"")}})},e}();e.ResCountSorted=s}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";var t=function(){function e(){this.g={},this.e={},this.o={},this.d={},this.total={}}return e}();e.ResCount=t;var s=function(){function e(){this.g=0,this.e=0,this.o=0,this.d=0,this.total=0}return e}();e.ResCountTotal=s}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";e._scrolls,e._cardsAndStats,e._typesCounts,e._cardsReport,e._allDecksStats=[],e._decks=[],e._decksCategorized=[e._decks,[],[]],e._decksStats=[{},{},{}]}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";function t(e,t,s){void 0===t&&(t=!1),void 0===s&&(s=!1),_.each(e,function(e){r(e,t,s)})}function s(e){_.each(e,function(e){r(e,!1,!1,!1,e)})}function n(t){return _.find(e._decks,function(e){return e.hash===t})}function r(t,s,n,r,a){void 0===s&&(s=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=null);var i=new e.Deck(t,s,n,a);return r&&(i.deck="Clone of "+i.deck),e._decks.push(i),o(i),i.id}function o(t){e._decksStats[0][t.code]=(e._decksStats[0][t.code]||0)+1,t.have===t.types.length?(e._decksStats[1][t.code]=(e._decksStats[1][t.code]||0)+1,e._decksCategorized[1].push(t)):(e._decksStats[2][t.code]=(e._decksStats[2][t.code]||0)+1,e._decksCategorized[2].push(t))}function a(t){e._decks[t.id]=null,t.types.forEach(function(s){var n=e._scrolls.look[s];n&&(delete n.decks[t.id],n.updateDecksCount())}),i(t),l()}function i(t){e._decksStats[0][t.code]--,e._decksStats[0][t.code]||delete e._decksStats[0][t.code],e._decksStats[1][t.code]?(e._decksStats[1][t.code]--,e._decksStats[1][t.code]||delete e._decksStats[1][t.code],e._decksCategorized[1].splice(e._decksCategorized[1].indexOf(t),1)):(e._decksStats[2][t.code]--,e._decksStats[2][t.code]||delete e._decksStats[2][t.code],e._decksCategorized[2].splice(e._decksCategorized[2].indexOf(t),1))}function c(e){return _.sortBy(_.map(e,function(e,t){var s=parseInt(t,10);return{count:e,val:s,g:8&s,e:4&s,o:2&s,d:1&s}}),"count").reverse()}function l(){return e._allDecksStats[0]=c(e._decksStats[0]),e._allDecksStats[1]=c(e._decksStats[1]),e._allDecksStats[2]=c(e._decksStats[2]),e._allDecksStats}function u(){_.each(e._scrolls.look,function(e){e.updateDecksCount()})}function d(){_.remove(e._decksCategorized[0]),_.remove(e._decksCategorized[1]),_.remove(e._decksCategorized[2])}e.AddDecks=t,e.AddStoredDecks=s,e.GetDeckByHash=n,e.AddDeck=r,e.addDeckStats=o,e.RemoveDeck=a,e.removeDeckStats=i,e.GetDecksStats=l,e.CountScrollsDecks=u,e.ResetDecks=d}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";var t=function(){function t(e){this.cards=[],this.deck=e,this.update()}return t.prototype.update=function(){var t=e.TypesToCards(this.deck.types,e._scrolls),s=e.HavingMissingRemainingCards(e._cardsReport[1].c,t);this.cards[0]=new e.CardsAndStats(s[0],!0,!0),this.cards[1]=new e.CardsAndStats(s[1],!0,!0),this.cards[2]=new e.CardsAndStats(s[2],!0,!0)},t.prototype.addType=function(t){e.removeDeckStats(this.deck);var s=this.deck.addType(t);return this.update(),e.addDeckStats(this.deck),e.GetDecksStats(),s},t.prototype.removeType=function(t){e.removeDeckStats(this.deck);var s=this.deck.removeType(t);return this.update(),e.addDeckStats(this.deck),e.GetDecksStats(),s},t.prototype.replaceDeck=function(e){this.deck.deck=e.deck,this.deck.author=e.author,this.deck.origin=e.origin,this.replaceTypes(e.types)},t.prototype.replaceTypes=function(t){var s=this;e.removeDeckStats(this.deck),_.each(_.clone(this.deck.types),function(e){s.deck.removeType(e)}),_.each(t,function(e){s.deck.types.push(e)}),this.deck.update(),this.update(),e.addDeckStats(this.deck),e.GetDecksStats()},t}();e.DeckCards=t}(ScrollsTypes||(ScrollsTypes={}));var __extends=this.__extends||function(e,t){function s(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);s.prototype=t.prototype,e.prototype=new s},ScrollsTypes;!function(e){"use strict";var t=function(){function e(e){var t=this;if(e)if(this.deck=e.deck,this.author=e.author,_.isString(e.types)){this.types=[];var s=e.types.toString().split(",");_.each(s,function(e){t.types.push(parseInt(e,10))})}else this.types=e.types}return e.prototype.getDeckHash=function(){return _.sortBy(this.types).join(",")},e}();e.DeckSimple=t;var s=function(e){function t(t){t&&(e.call(this,t),this.origin=t.origin)}return __extends(t,e),t}(t);e.DeckExtended=s;var n=function(n){function r(t,s,r,o){void 0===o&&(o=null),n.call(this),this.origin=t.origin||(r?"http://scrolls.com":""),this.author=t.author,this.deck=t.deck,this.types=t.types||[],this.starter=s,this.id=e._decks.length,this.storageId=o,this.update()}return __extends(r,n),Object.defineProperty(r.prototype,"hash",{get:function(){return this.getDeckHash()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"deck",{get:function(){return this._deck},set:function(e){this._deck=e||"?",this.deckLowerCase=this._deck.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"author",{get:function(){return this._author},set:function(e){this._author=e||"?",this.authorLowerCase=this._author.toLowerCase()},enumerable:!0,configurable:!0}),r.prototype.update=function(){this.countTypes(),this.updatePricing(),this.updateSortString(),this.updateResourcePercents(),this.updateResourceFlags(),this.updateCode(),this.updateStats()},r.prototype.toDeckSimple=function(){return new t(this)},r.prototype.toDeckExtended=function(){return new s(this)},r.prototype.addType=function(e){var t=this.counts[e]||0;return 3>t?(this.types.push(e),this.counts[e]=t+1,this.update(),1):0},r.prototype.removeType=function(e){var t=this.counts[e]||0;return t>1?(this.counts[e]=t-1,this.types.splice(this.types.indexOf(e),1),this.update(),1):t>0?(delete this.counts[e],this.types.splice(this.types.indexOf(e),1),this.update(),1):0},r.prototype.countTypes=function(){var t=this;this.counts={},this.growth=0,this.order=0,this.energy=0,this.decay=0,this.types.forEach(function(s){var n=e._scrolls.look[s];n&&(t.growth+=n.growth?1:0,t.energy+=n.energy?1:0,t.decay+=n.decay?1:0,t.order+=n.order?1:0,n.decks[t.id]=t),t.counts[s]=(t.counts[s]||0)+1})},r.prototype.updatePricing=function(){var t=0,s=0,n=0;_.each(this.counts,function(r,o){var a=e._typesCounts.items[o]||0;t+=a>=r?r:a;var i=e._scrolls.look[o]?e._scrolls.look[o].price:0;n+=r*i,r>a&&(s+=(r-a)*i)}),this.havePercent=Math.floor(t/(this.types.length||1)*100),this.have=t,this.price=s,this.priceTotal=n},r.prototype.updateResourcePercents=function(){this.growthPercent=this.growth/(this.types.length||1)*100,this.energyPercent=this.energy/(this.types.length||1)*100,this.decayPercent=this.decay/(this.types.length||1)*100,this.orderPercent=this.order/(this.types.length||1)*100},r.prototype.updateSortString=function(){function e(e){return(10>e?"00":100>e?"0":"")+e}this.sort=e(this.growth)+e(this.energy)+e(this.order)+e(this.decay)},r.prototype.updateResourceFlags=function(){this.g=this.growth>0,this.e=this.energy>0,this.o=this.order>0,this.d=this.decay>0},r.prototype.updateCode=function(){this.code=(this.g?8:0)+(this.e?4:0)+(this.o?2:0)+(this.d?1:0)},r.prototype.updateStats=function(){var t=[];_.each(this.counts,function(s,n){t.push(new e.Card(e._scrolls.look[n],s))}),this.stats=new e.Stats(t,!0,!0)},r}(s);e.Deck=n}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";var t=function(){function t(t,s){this[0]=new e.CardsAndStats(e.ScrollsToCards(s.parsed)),this[1]=new e.CardsAndStats(e.TypesToCards(t,s)),this[2]=new e.CardsAndStats(e.MissingCards(this[1].c,s))}return t}();e.CardsReport=t}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";var t=function(){function t(t,s,n){void 0===s&&(s=!1),void 0===n&&(n=!1),this.c=t,this.s=new e.Stats(t,s,n)}return t}();e.CardsAndStats=t}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";function t(t,s){var n=[],r={};return _.each(t,function(t){s.look[t]&&(r[t]?r[t].c++:(r[t]=new e.Card(s.look[t],1),n.push(r[t])))}),n}function s(t){var s=[];return t.forEach(function(t){s.push(new e.Card(t,1))}),s}function n(t,s){var n=[],r={};return t.forEach(function(t){r[t.s.id]=new e.Card(t.s,3-t.c),r[t.s.id].c&&n.push(r[t.s.id])}),_.each(s.look,function(t,s){r[s]||n.push(new e.Card(t,3))}),n}function r(t,s,n){function r(s){o.length<n&&s!==t.s&&!_.find(o,function(e){return e.s===s})&&o.push(new e.Card(s))}void 0===n&&(n=25);var o=[];return _.each(_.clone(t.s.typesArr).reverse(),function(e){_.each(s.types[t.s.r][e],r)}),o.length||_.each(s.kinds[t.s.r][t.s.kind],r),o}function o(t,s){var n=[],r=[],o=[],a={};return _.each(t,function(t){var s=new e.Card(t.s,t.c);o.push(s),a[t.s.id]=s}),_.each(s,function(e){var t,s=a[e.s.id]?a[e.s.id].c:0,i=e.c;s>=i?(n.push({c:i,s:e.s}),t=s-i,t>0&&o.push({c:t,s:e.s})):0===s?r.push({c:i,s:e.s}):(n.push({c:s,s:e.s}),r.push({c:i-s,s:e.s}))}),[s,n,r,o]}var a=function(){function e(e){var t=this;this.items={},_.each(e,function(e){t.items[e.s.id]=e.c})}return e}();e.TypesCounts=a,e.TypesToCards=t,e.ScrollsToCards=s,e.MissingCards=n,e.RelatedCards=r,e.HavingMissingRemainingCards=o}(ScrollsTypes||(ScrollsTypes={}));var ScrollsTypes;!function(e){"use strict";var t=function(){function e(e,t){void 0===t&&(t=1),this.s=e,this.c=t}return e}();e.Card=t}(ScrollsTypes||(ScrollsTypes={}));